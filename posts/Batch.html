<!DOCTYPE html><html><head><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-144334903-1","auto"),ga("send","pageview")</script><script async src="https://www.google-analytics.com/analytics.js"></script><meta charset="utf-8"><meta name="sogou_site_verification" content="ivC590WMZh"><link rel="canonical" href="https://vitan.me/posts/Batch.html"><title>Batch - Vitan&#39;s Blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#3F51B5"><meta name="keywords" content="Windows,Batch"><meta name="description" content="Batch 批量处理相关。%~dp0[获取当前路径]%~dp0 “d”为Drive的缩写，即为驱动器，磁盘、“p”为Path缩写，即为路径，目录cd %~dp0 ：进入批处理所在目录cd %~dp0bin\ ：进入批处理所在目录的bin目录"><meta property="og:type" content="article"><meta property="og:title" content="Batch"><meta property="og:url" content="https://vitan.me/posts/Batch.html"><meta property="og:site_name" content="Vitan&#39;s Blog"><meta property="og:description" content="Batch 批量处理相关。%~dp0[获取当前路径]%~dp0 “d”为Drive的缩写，即为驱动器，磁盘、“p”为Path缩写，即为路径，目录cd %~dp0 ：进入批处理所在目录cd %~dp0bin\ ：进入批处理所在目录的bin目录"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2019-12-11T01:23:23.000Z"><meta property="article:modified_time" content="2020-04-28T06:08:18.000Z"><meta property="article:author" content="Vitan"><meta property="article:tag" content="Windows"><meta property="article:tag" content="Batch"><meta name="twitter:card" content="summary"><link rel="alternate" type="application/atom+xml" title="Vitan&#39;s Blog" href="/xml/atom.xml"><link rel="shortcut icon" href="/img/favicon.png"><link rel="stylesheet" href="/css/style.css?v=1.7.2"><script>window.lazyScripts=[]</script><meta name="generator" content="Hexo 4.2.0"></head><body><div id="loading" class="active"></div><aside id="menu" class="hide"><div class="inner flex-row-vertical"><a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off"><i class="icon icon-lg icon-close"></i></a><div class="brand-wrap" style="background-image:url(/img/brand.png)"><div class="brand"><a href="/" class="avatar waves-effect waves-circle waves-light"><img src="/img/ivitan.png"></a><hgroup class="introduce"><h5 class="nickname">Vitan</h5><a href="mailto:admin@vitan.me" title="admin@vitan.me" class="mail">admin@vitan.me</a></hgroup></div></div><div class="scroll-wrap flex-col"><ul class="nav"><li class="waves-block waves-effect"><a href="/"><i class="icon icon-lg icon-home"></i> 主页</a></li><li class="waves-block waves-effect"><a href="/tags"><i class="icon icon-lg icon-tags"></i> 标签</a></li><li class="waves-block waves-effect"><a href="/categories"><i class="icon icon-lg icon-th-list"></i> 分类</a></li><li class="waves-block waves-effect"><a href="/archives"><i class="icon icon-lg icon-archives"></i> 归档</a></li><li class="waves-block waves-effect"><a href="/about"><i class="icon icon-lg icon-info-circle"></i> 关于</a></li><li class="waves-block waves-effect"><a href="https://github.com/ivitan" target="_blank"><i class="icon icon-lg icon-github"></i> Github</a></li></ul></div></div></aside><main id="main"><header class="top-header" id="header"><div class="flex-row"><a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle"><i class="icon icon-lg icon-navicon"></i></a><div class="flex-col header-title ellipsis">Batch</div><div class="search-wrap" id="search-wrap"><a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back"><i class="icon icon-lg icon-chevron-left"></i> </a><input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字"> <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search"><i class="icon icon-lg icon-search"></i></a></div><a href="https://github.com/ivitan" class="header-icon waves-effect waves-circle waves-light" target="_blank" title="Github"><i class="icon icon-lg icon-github"></i></a></div></header><header class="content-header post-header"><div class="container fade-scale"><h1 class="title">Batch</h1><h5 class="subtitle"><time datetime="2019-12-11T01:23:23.000Z" itemprop="datePublished" class="page-time">2019-12-11</time><ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Coding/">Coding</a></li></ul></h5></div></header><div class="container body-wrap"><aside class="post-widget"><nav class="post-toc-wrap post-toc-shrink" id="post-toc"><h4>TOC</h4><ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#dp0-获取当前路径"><span class="post-toc-number">1.</span> <span class="post-toc-text">%~dp0[获取当前路径]</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#常用命令"><span class="post-toc-number">2.</span> <span class="post-toc-text">常用命令</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#cd-执行的路径"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">%cd%[执行的路径]</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#taskill"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">taskill</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#获取命令帮助-xxx"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">获取命令帮助 xxx &#x2F;?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#查看内置命令帮助信息"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">查看内置命令帮助信息</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#其他常用的命令"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">其他常用的命令</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#基础语法"><span class="post-toc-number">3.</span> <span class="post-toc-text">基础语法</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#参数"><span class="post-toc-number">4.</span> <span class="post-toc-text">参数</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#系统参数"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">系统参数</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#传递参数给批处理文件"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">传递参数给批处理文件</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#批处理基本命令"><span class="post-toc-number">5.</span> <span class="post-toc-text">批处理基本命令</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#help-命令"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">help 命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Echo-命令"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">Echo 命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#命令"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">@ 命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Goto-命令"><span class="post-toc-number">5.4.</span> <span class="post-toc-text">Goto 命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Rem-命令"><span class="post-toc-number">5.5.</span> <span class="post-toc-text">Rem 命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Pause-命令"><span class="post-toc-number">5.6.</span> <span class="post-toc-text">Pause 命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Call-命令"><span class="post-toc-number">5.7.</span> <span class="post-toc-text">Call 命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Start-命令"><span class="post-toc-number">5.8.</span> <span class="post-toc-text">Start 命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#If-命令"><span class="post-toc-number">5.9.</span> <span class="post-toc-text">If 命令</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#If-exist"><span class="post-toc-number">5.9.1.</span> <span class="post-toc-text">If exist</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#If-errorlevel-number"><span class="post-toc-number">5.9.2.</span> <span class="post-toc-text">If errorlevel number</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Else"><span class="post-toc-number">5.9.3.</span> <span class="post-toc-text">Else</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#比较运算符"><span class="post-toc-number">5.9.4.</span> <span class="post-toc-text">比较运算符:</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Choice-命令"><span class="post-toc-number">5.10.</span> <span class="post-toc-text">Choice 命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#For-命令"><span class="post-toc-number">5.11.</span> <span class="post-toc-text">For 命令</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#如果命令扩展名被启用，额外的-FOR-命令格式会受到支持"><span class="post-toc-number">5.11.1.</span> <span class="post-toc-text">如果命令扩展名被启用，额外的 FOR 命令格式会受到支持</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#continue-和-break"><span class="post-toc-number">5.12.</span> <span class="post-toc-text">continue 和 break</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#其它命令"><span class="post-toc-number">6.</span> <span class="post-toc-text">其它命令</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ping-命令"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">ping 命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#telnet-命令"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">telnet 命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#color-命令"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">color 命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#random-命令"><span class="post-toc-number">6.4.</span> <span class="post-toc-text">random 命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#exit-命令"><span class="post-toc-number">6.5.</span> <span class="post-toc-text">exit 命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#shutdown命令"><span class="post-toc-number">6.6.</span> <span class="post-toc-text">shutdown命令</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#字符串处理"><span class="post-toc-number">7.</span> <span class="post-toc-text">字符串处理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#分割字符串，以查看时间为例"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">分割字符串，以查看时间为例</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#替换字符串"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">替换字符串</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#字符串合并"><span class="post-toc-number">7.3.</span> <span class="post-toc-text">字符串合并</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#计算字符串长度"><span class="post-toc-number">7.4.</span> <span class="post-toc-text">计算字符串长度</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#截取字符串时，需要传递参数"><span class="post-toc-number">7.5.</span> <span class="post-toc-text">截取字符串时，需要传递参数</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#注册表操作"><span class="post-toc-number">8.</span> <span class="post-toc-text">注册表操作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#备份注册表"><span class="post-toc-number">8.1.</span> <span class="post-toc-text">备份注册表</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#修改-添加注册表内容"><span class="post-toc-number">8.2.</span> <span class="post-toc-text">修改&#x2F;添加注册表内容</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#使用变量"><span class="post-toc-number">8.3.</span> <span class="post-toc-text">使用变量</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#注册表的名称有空格，或者数据用特殊符号时"><span class="post-toc-number">8.4.</span> <span class="post-toc-text">注册表的名称有空格，或者数据用特殊符号时</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#增加空的内容"><span class="post-toc-number">8.5.</span> <span class="post-toc-text">增加空的内容</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#添加或修改默认值"><span class="post-toc-number">8.6.</span> <span class="post-toc-text">添加或修改默认值</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#删除注册表的内容"><span class="post-toc-number">8.7.</span> <span class="post-toc-text">删除注册表的内容</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#注册表的常用位置"><span class="post-toc-number">8.8.</span> <span class="post-toc-text">注册表的常用位置</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#系统环境变量："><span class="post-toc-number">8.9.</span> <span class="post-toc-text">系统环境变量：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#当前用户的环境变量："><span class="post-toc-number">8.10.</span> <span class="post-toc-text">当前用户的环境变量：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#刷新注册表"><span class="post-toc-number">8.11.</span> <span class="post-toc-text">刷新注册表</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#系统服务"><span class="post-toc-number">9.</span> <span class="post-toc-text">系统服务</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#停止-启动"><span class="post-toc-number">9.1.</span> <span class="post-toc-text">停止&#x2F;启动</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#设置启动类型"><span class="post-toc-number">9.2.</span> <span class="post-toc-text">设置启动类型</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#查看系统服务："><span class="post-toc-number">9.3.</span> <span class="post-toc-text">查看系统服务：</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#setlocal与变量延迟"><span class="post-toc-number">10.</span> <span class="post-toc-text">setlocal与变量延迟</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#文件处理"><span class="post-toc-number">11.</span> <span class="post-toc-text">文件处理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#删除"><span class="post-toc-number">11.1.</span> <span class="post-toc-text">删除</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#创建目录"><span class="post-toc-number">11.2.</span> <span class="post-toc-text">创建目录</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#实践部分"><span class="post-toc-number">12.</span> <span class="post-toc-text">实践部分</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#实例"><span class="post-toc-number">13.</span> <span class="post-toc-text">实例</span></a></li></ol></nav></aside><article id="post-Batch" class="post-article article-type-post fade" itemprop="blogPost"><div class="post-card"><h1 class="post-card-title">Batch</h1><div class="post-meta"><time class="post-time" title="2019-12-11 09:23:23" datetime="2019-12-11T01:23:23.000Z" itemprop="datePublished"><i class="icon icon-calendar"></i> 2019-12-11</time><ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Coding/">Coding</a></li></ul><span id="busuanzi_container_page_pv" title="文章总阅读量" style="display:none"><i class="icon icon-eye" style="padding:0 .3em"></i><span id="busuanzi_value_page_pv"></span></span></div><div class="post-content" id="post-content" itemprop="postContent"><blockquote><p>Batch 批量处理相关。</p></blockquote><h1 id="dp0-获取当前路径"><a href="#dp0-获取当前路径" class="headerlink" title="%~dp0[获取当前路径]"></a>%~dp0[获取当前路径]</h1><ol><li>%~dp0 “d”为Drive的缩写，即为驱动器，磁盘、“p”为Path缩写，即为路径，目录</li><li>cd %~dp0 ：进入批处理所在目录</li><li>cd %~dp0bin\ ：进入批处理所在目录的bin目录</li></ol><a id="more"></a><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM 作用：以管理员身份安装Apache</span></span><br><span class="line"><span class="function">d:</span></span><br><span class="line"><span class="function"><span class="title">cd</span> %~<span class="title">dp0bin</span>\</span></span><br><span class="line"><span class="function"><span class="title">httpd.exe</span> -<span class="title">k</span> <span class="title">install</span> -<span class="title">n</span> "<span class="title">Apache24</span>"</span></span><br></pre></td></tr></table></figure><p>以管理员身份运行 示例.bat ，执行结果如下：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Windows</span>\<span class="title">system32</span>&gt;<span class="title">d</span>:</span></span><br><span class="line"><span class="function"><span class="title">D</span>:\&gt;<span class="title">cd</span> <span class="title">D</span>:\<span class="title">Server</span>\<span class="title">Apache24</span>\<span class="title">bin</span>\</span></span><br><span class="line"><span class="function"><span class="title">D</span>:\<span class="title">Server</span>\<span class="title">Apache24</span>\<span class="title">bin</span>&gt;<span class="title">httpd.exe</span> -<span class="title">k</span> <span class="title">install</span> -<span class="title">n</span> "<span class="title">Apache24</span>"</span></span><br></pre></td></tr></table></figure><h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><h2 id="cd-执行的路径"><a href="#cd-执行的路径" class="headerlink" title="%cd%[执行的路径]"></a>%cd%[执行的路径]</h2><p>当前执行的路径，并非目标文件的路径</p><h2 id="taskill"><a href="#taskill" class="headerlink" title="taskill"></a>taskill</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">taskkill</span> /f /im notepad.exe [终止进程]</span><br><span class="line"><span class="built_in">taskkill</span> /?打开帮助</span><br></pre></td></tr></table></figure><h2 id="获取命令帮助-xxx"><a href="#获取命令帮助-xxx" class="headerlink" title="获取命令帮助 xxx /?"></a>获取命令帮助 xxx /?</h2><p>遇到记不清楚的命令，但记得名字，就可以键入 命令名 空格 /?就会有详细的该命令的帮助了，比如：ping /? , cd /?</p><h2 id="查看内置命令帮助信息"><a href="#查看内置命令帮助信息" class="headerlink" title="查看内置命令帮助信息"></a>查看内置命令帮助信息</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ver</span> /?</span><br><span class="line"><span class="built_in">cmd</span> /?</span><br><span class="line"><span class="built_in">set</span> /?</span><br><span class="line"><span class="comment">rem /?</span></span><br><span class="line"><span class="keyword">if</span> /?</span><br><span class="line"><span class="built_in">echo</span> /?</span><br><span class="line"><span class="keyword">goto</span> /?</span><br><span class="line"><span class="keyword">for</span> /?</span><br><span class="line"><span class="built_in">shift</span> /?</span><br><span class="line"><span class="keyword">call</span> /?</span><br></pre></td></tr></table></figure><h2 id="其他常用的命令"><a href="#其他常用的命令" class="headerlink" title="其他常用的命令"></a>其他常用的命令</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> /?</span><br><span class="line"><span class="built_in">find</span> /?</span><br><span class="line"><span class="built_in">findstr</span> /?</span><br><span class="line"><span class="built_in">copy</span> /?</span><br></pre></td></tr></table></figure><h1 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h1><ol><li>批处理文件是一个“.bat”结尾的文本文件，这个文件的每一行都是一条DOS命令。可以使用任何文本文件编辑工具创建和修改。</li><li>批处理是一种简单的程序，可以用 if 和 goto 来控制流程，也可以使用 for 循环。</li><li>批处理的编程能力远不如C语言等编程语言，也十分不规范。</li><li>每个编写好的批处理文件都相当于一个DOS的外部命令，把它所在的目录放到DOS搜索路径(path)中，即可在任意位置运行。</li><li>C:\AUTOEXEC.BAT 是每次系统启动时都会自动运行的，可以将每次启动时都要运行的命令放入该文件中。</li><li>大小写不敏感(命令符忽略大小写)</li><li>批处理的文件扩展名为 .bat 或 .cmd。</li><li>在命令提示下键入批处理文件的名称，或者双击该批处理文件，系统就会调用Cmd.exe来运行该文件。</li></ol><h1 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h1><h2 id="系统参数"><a href="#系统参数" class="headerlink" title="系统参数"></a>系统参数</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">%SystemRoot%</span> ===&gt; C:\WINDOWS (<span class="variable">%windir%</span> 同样)</span><br><span class="line"><span class="variable">%ProgramFiles%</span> ===&gt; C:\Program Files</span><br><span class="line"><span class="variable">%USERPROFILE%</span> ===&gt; C:\Documents and Settings\Administrator (子目录有“桌面”,“开始菜单”,“收藏夹”等)</span><br><span class="line"><span class="variable">%APPDATA%</span> ===&gt; C:\Documents and Settings\Administrator\Application Data</span><br><span class="line"><span class="variable">%TEMP%</span> ===&gt; C:\DOCUME~<span class="number">1</span>\ADMINI~<span class="number">1</span>\LOCALS~<span class="number">1</span>\Temp (<span class="variable">%TEM%</span> 同样)</span><br><span class="line"><span class="variable">%APPDATA%</span> ===&gt; C:\Documents and Settings\Administrator\Application Data</span><br><span class="line"><span class="variable">%OS%</span> ===&gt; Windows_NT (系统)</span><br><span class="line"><span class="variable">%Path%</span> ===&gt; <span class="variable">%SystemRoot%</span>\system32;<span class="variable">%SystemRoot%</span>;<span class="variable">%SystemRoot%</span>\System32\Wbem (原本的设置)</span><br><span class="line"><span class="variable">%HOMEDRIVE%</span> ===&gt; C: (系统盘)</span><br><span class="line"><span class="variable">%HOMEPATH%</span> ===&gt; \Documents and Settings\Administrator</span><br><span class="line"></span><br><span class="line"><span class="comment">REM 枚举当前的环境变量</span></span><br><span class="line"><span class="built_in">setlocal</span> enabledelayedexpansion</span><br><span class="line"><span class="keyword">FOR</span> /F "usebackq delims==" <span class="variable">%%i</span> <span class="keyword">IN</span> (`<span class="built_in">set</span>`) <span class="keyword">DO</span> @<span class="built_in">echo</span> <span class="variable">%%i</span> <span class="variable">!%%i!</span></span><br></pre></td></tr></table></figure><h2 id="传递参数给批处理文件"><a href="#传递参数给批处理文件" class="headerlink" title="传递参数给批处理文件"></a>传递参数给批处理文件</h2><p>%[1-9]表示参数，参数是指在运行批处理文件时在文件名后加的以空格(或者Tab)分隔的字符串。</p><p>变量可以从%0到%9，%0表示批处理命令本身，其它参数字符串用 %1 到 %9 顺序表示。</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM 执行同目录下的“test2.bat”文件，并输入两个参数</span></span><br><span class="line"><span class="keyword">call</span> test2.bat "hello" "haha"</span><br></pre></td></tr></table></figure><p>在“test2.bat”文件里写:</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> %<span class="number">1</span> (打印: "hello")</span><br><span class="line"><span class="built_in">echo</span> %<span class="number">2</span> (打印: "haha")</span><br><span class="line"><span class="built_in">echo</span> %<span class="number">0</span> (打印: test2.bat)</span><br><span class="line"><span class="built_in">echo</span> %<span class="number">19</span> (打印: "hello"<span class="number">9</span>)</span><br></pre></td></tr></table></figure><h1 id="批处理基本命令"><a href="#批处理基本命令" class="headerlink" title="批处理基本命令"></a>批处理基本命令</h1><h2 id="help-命令"><a href="#help-命令" class="headerlink" title="help 命令"></a>help 命令</h2><p>/? 命令，语法： 命令 /?</p><p>可显示此命令的帮助信息</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM 把 type 命令的帮助信息写入到tmp.txt文件里</span></span><br><span class="line"><span class="built_in">type</span> /? &gt;&gt;tmp.txt</span><br></pre></td></tr></table></figure><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">help</span> <span class="built_in">type</span> (显示跟“<span class="built_in">type</span> /?”一样)</span><br></pre></td></tr></table></figure><h2 id="Echo-命令"><a href="#Echo-命令" class="headerlink" title="Echo 命令"></a>Echo 命令</h2><p>语法:</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> [&#123;on|off&#125;] [message]</span><br><span class="line"><span class="built_in">ECHO</span> [ON | OFF] 打开回显或关闭回显功能。</span><br><span class="line"><span class="built_in">ECHO</span> 显示当前回显设置。</span><br><span class="line"><span class="built_in">ECHO</span> [message] 显示信息。</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> off </span><br><span class="line">表示在此语句后所有运行的命令都不显示命令行本身；</span><br><span class="line">默认是on，on时会显示如： C:\文件夹路径&gt;命令行。</span><br></pre></td></tr></table></figure><p>在实际应用中我们会把这条命令和重定向符号( 也称为管道符号，一般用 &gt; &gt;&gt; ^ )结合来实现输入一些命令到特定格式的文件中。</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> off</span><br><span class="line"></span><br><span class="line"><span class="comment">REM 显示出“hello world”</span></span><br><span class="line"><span class="built_in">echo</span> hello world </span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> Windows Registry Editor Version <span class="number">5</span>.<span class="number">00</span> &gt; c:\setupreg.reg </span><br><span class="line"></span><br><span class="line"><span class="comment">REM 追加内容进 setupreg.reg 这个文件</span></span><br><span class="line"><span class="built_in">echo</span> "SourcePath"="D:\\Win2003\\" &gt;&gt; c:\setupreg.reg</span><br></pre></td></tr></table></figure><h2 id="命令"><a href="#命令" class="headerlink" title="@ 命令"></a>@ 命令</h2><p>表示不显示@后面的命令</p><p>@ 与 echo off 相象，但它是加在每个命令行的最前面，表示运行时不显示这一行的命令行(只能影响当前行)。</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off </span><br><span class="line"><span class="comment">REM 此语句常用于开头，表示不显示所有的命令行信息，包括此句</span></span><br><span class="line"></span><br><span class="line">@<span class="built_in">echo</span> please wait a minite...</span><br><span class="line">@<span class="built_in">format</span> X: /q/u/autoset</span><br></pre></td></tr></table></figure><p>format 这个命令是不可以使用/y这个参数的，可喜的是微软留了个autoset这个参数给我们，效果和/y是一样的。</p><h2 id="Goto-命令"><a href="#Goto-命令" class="headerlink" title="Goto 命令"></a>Goto 命令</h2><p>语法：goto label (label是参数，指定所要转向的批处理程序中的行。)</p><p>指定跳转到标签行，找到标签行后，程序将处理从下一行开始的命令。</p><p>label标签的名字可以随便起，但是最好是有意义的，字母前必须加个冒号“:”来表示这个字母是标签。</p><p>goto命令就是根据这个冒号来寻找下一步跳到到那里。经常与 if 配合使用，根据不同的条件来执行不同的命令组。</p><h2 id="Rem-命令"><a href="#Rem-命令" class="headerlink" title="Rem 命令"></a>Rem 命令</h2><p>语法：Rem Message…(小技巧：用::代替rem)</p><p>注释命令，在C语言中相当与/<em>…</em>/,它并不会被执行，只是起一个注释的作用，便于别人阅读和自己日后修改。</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">@Rem Here is the description.</span></span><br></pre></td></tr></table></figure><h2 id="Pause-命令"><a href="#Pause-命令" class="headerlink" title="Pause 命令"></a>Pause 命令</h2><p>会暂停批处理的执行并在屏幕上显示Press any key to continue…的提示，等待用户按任意键后继续</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">:begin</span><br><span class="line"><span class="built_in">copy</span> a:*.* d:\back</span><br><span class="line"><span class="built_in">echo</span> Please put a new disk into driver A</span><br><span class="line"><span class="built_in">pause</span></span><br><span class="line"><span class="keyword">goto</span> begin</span><br></pre></td></tr></table></figure><p>在这个例子中，驱动器 A 中磁盘上的所有文件均复制到d:\back中。</p><p>显示的信息提示您将另一张磁盘放入驱动器 A 时，pause 命令会使程序挂起，以便您更换磁盘，然后按任意键再次复制。</p><h2 id="Call-命令"><a href="#Call-命令" class="headerlink" title="Call 命令"></a>Call 命令</h2><p>语法:</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> [[Drive:][<span class="built_in">Path</span>] FileName [BatchParameters]] [:<span class="built_in">label</span> [arguments]]</span><br></pre></td></tr></table></figure><p>参数:</p><p><code>[Drive:][Path] FileName</code> 指定要调用的批处理程序的位置和名称。filename 参数必须具有 <code>.bat</code> 或 <code>.cmd</code> 扩展名。</p><p>调用另一个批处理程序，并且不终止父批处理程序。如果不用call而直接调用别的批处理文件，那么执行完那个批处理文件后将无法返回当前文件并执行当前文件的后续命令。call 命令接受用作调用目标的标签。如果在脚本或批处理文件外使用 Call，它将不会在命令行起作用。</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM 调用指定目录下的 test2.bat，且输入3个参数给他</span></span><br><span class="line"><span class="keyword">call</span>="<span class="variable">%cd%</span>\test2.bat" haha kkk aaa</span><br><span class="line"></span><br><span class="line"><span class="comment">REM 调用同目录下的 test2.bat，且输入2个参数给他</span></span><br><span class="line"><span class="keyword">call</span> test2.bat arg1 arg2</span><br></pre></td></tr></table></figure><p>注：可以调用自身(死循环、递归)</p><h2 id="Start-命令"><a href="#Start-命令" class="headerlink" title="Start 命令"></a>Start 命令</h2><p>调用外部程序，所有的 DOS命令 和 命令行程序 都可以由 start命令 来调用。</p><p>常用参数：</p><ul><li>MIN 开始时窗口最小化</li><li>SEPARATE 在分开的空间内开始 16 位 Windows 程序</li><li>HIGH 在 HIGH 优先级类别开始应用程序</li><li>REALTIME 在 REALTIME 优先级类别开始应用程序</li><li>WAIT 启动应用程序并等候它结束</li><li>parameters 这些为传送到命令/程序的参数</li></ul><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM 调用同目录下的 test2.bat，且输入2个参数给他，且本窗口最小化</span></span><br><span class="line"><span class="built_in">start</span> /MIN test2.bat arg1 arg2</span><br><span class="line"></span><br><span class="line"><span class="comment">REM 文件路径名有空格时</span></span><br><span class="line"><span class="function">e:\"<span class="title">program</span> <span class="title">files</span>"\<span class="title">qq.exe</span></span></span><br></pre></td></tr></table></figure><h2 id="If-命令"><a href="#If-命令" class="headerlink" title="If 命令"></a>If 命令</h2><p>if 表示将判断是否符合规定的条件，从而决定执行不同的命令。有三种格式:</p><p>语法:</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [<span class="keyword">not</span>] "参数" == "字符串" 待执行的命令</span><br></pre></td></tr></table></figure><p>参数如果等于(not表示不等，下同)指定的字符串，则条件成立，运行命令，否则运行下一句。(注意是两个等号)</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> "%<span class="number">1</span>" == "a" <span class="built_in">format</span> a:</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> &#123;%<span class="number">1</span>&#125; == &#123;&#125; <span class="keyword">goto</span> noparms</span><br></pre></td></tr></table></figure><h3 id="If-exist"><a href="#If-exist" class="headerlink" title="If exist"></a>If exist</h3><p>语法: if [not] exist [路径]文件名 待执行的命令</p><p>如果有指定的文件，则条件成立，运行命令，否则运行下一句。</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM 存在这文件，则编辑它，用很难看的系统编辑器</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">exist</span> config.sys edit config.sys</span><br><span class="line"></span><br><span class="line"><span class="comment">REM 如果存在这文件，则显示它的内容</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">exist</span> config.sys <span class="built_in">type</span> config.sys</span><br></pre></td></tr></table></figure><h3 id="If-errorlevel-number"><a href="#If-errorlevel-number" class="headerlink" title="If errorlevel number"></a>If errorlevel number</h3><p>语法: if [not] errorlevel &lt;数字&gt; 待执行的命令</p><p>如果程序返回值等于指定的数字，则条件成立，运行命令，否则运行下一句。(返回值必须按照从大到小的顺序排列)</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">XCOPY</span> F:\test.bat D:\</span><br><span class="line"><span class="keyword">IF</span> <span class="keyword">ERRORLEVEL</span> <span class="number">1</span> (<span class="built_in">ECHO</span> 文件拷贝失败</span><br><span class="line">) <span class="keyword">Else</span> <span class="keyword">IF</span> <span class="keyword">ERRORLEVEL</span> <span class="number">0</span> <span class="built_in">ECHO</span> 成功拷贝文件</span><br><span class="line"></span><br><span class="line"><span class="built_in">pause</span></span><br></pre></td></tr></table></figure><p>很多DOS程序在运行结束后会返回一个数字值用来表示程序运行的结果(或者状态)，称为错误码errorlevel或称返回码。</p><p>常见的返回码为0、1。通过if errorlevel命令可以判断程序的返回值，根据不同的返回值来决定执行不同的命令。</p><h3 id="Else"><a href="#Else" class="headerlink" title="Else"></a>Else</h3><p>语法： if 条件 (成立时执行的命令) else (不成立时执行的命令)</p><p>如果是多个条件，建议适当使用括号把各条件包起来，以免出错。</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="number">1</span> == <span class="number">0</span> ( <span class="built_in">echo</span> comment1 ) <span class="keyword">else</span> <span class="keyword">if</span> <span class="number">1</span>==<span class="number">0</span> ( <span class="built_in">echo</span> comment2 ) <span class="keyword">else</span> (<span class="built_in">echo</span> comment3 )</span><br><span class="line"><span class="comment">REM 如果 else 的语句需要换行，if 执行的行尾需用“^”连接，并且 if 执行的动作需用(括起来)，否则报错</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="number">1</span> == <span class="number">0</span> ( <span class="built_in">echo</span> comment1 ) <span class="keyword">else</span> <span class="keyword">if</span> <span class="number">1</span>==<span class="number">0</span> ( <span class="built_in">echo</span> comment2 ) ^</span><br><span class="line"><span class="keyword">else</span> (<span class="built_in">echo</span> comment3 )</span><br></pre></td></tr></table></figure><h3 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符:"></a>比较运算符:</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EQU</span> - 等于 (一般使用“==”)</span><br><span class="line"><span class="keyword">NEQ</span> - 不等于 (没有 “!=”,改用“ <span class="keyword">if</span> <span class="keyword">not</span> <span class="number">1</span>==<span class="number">1</span> ”的写法)</span><br><span class="line"><span class="keyword">LSS</span> - 小于</span><br><span class="line"><span class="keyword">LEQ</span> - 小于或等于</span><br><span class="line"><span class="keyword">GTR</span> - 大于</span><br><span class="line"><span class="keyword">GEQ</span> - 大于或等于</span><br></pre></td></tr></table></figure><h2 id="Choice-命令"><a href="#Choice-命令" class="headerlink" title="Choice 命令"></a>Choice 命令</h2><p>choice 使用此命令可以让用户输入一个字符(用于选择)，从而根据用户的选择返回不同的 errorlevel，然后配合 if errorlevel 选择运行不同的命令。</p><p>注意：choice命令为DOS或者Windows系统提供的外部命令，不同版本的choice命令语法会稍有不同，请用choice /?查看用法。choice 使用此命令可以让用户输入一个字符，从而运行不同的命令。使用时应该加/c:参数，c:后应写提示可输入的字符，之间无空格。它的返回码为1234……</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">choice /c:dme defrag,mem,end</span><br></pre></td></tr></table></figure><p>将显示: defrag,mem,end[D,M,E]?</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">choice /c:dme defrag,mem,end</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">errorlevel</span> <span class="number">3</span> <span class="keyword">goto</span> defrag (应先判断数值最高的错误码)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">errorlevel</span> <span class="number">2</span> <span class="keyword">goto</span> mem</span><br><span class="line"><span class="keyword">if</span> errotlevel <span class="number">1</span> <span class="keyword">goto</span> end</span><br></pre></td></tr></table></figure><h2 id="For-命令"><a href="#For-命令" class="headerlink" title="For 命令"></a>For 命令</h2><p>for 命令是一个比较复杂的命令，主要用于参数在指定的范围内循环执行命令。</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> &#123;%variable | <span class="variable">%%v</span>ariable&#125; <span class="keyword">in</span> (<span class="built_in">set</span>) <span class="keyword">do</span> command [command-parameters]</span><br></pre></td></tr></table></figure><ul><li><code>%variable</code> 指定一个单一字母可替换的参数。变量名称是区分大小写的，所以 %i 不同于 %I,在批处理文件中使用 FOR 命令时，指定变量建议用 %%variable而不要用 %variable</li><li><code>set</code> 指定一个或一组文件。可以使用通配符</li><li><code>command</code> 指定对每个文件执行的命令</li><li><code>command-parameters</code> 为特定命令指定参数或命令行开关。</li></ul><h3 id="如果命令扩展名被启用，额外的-FOR-命令格式会受到支持"><a href="#如果命令扩展名被启用，额外的-FOR-命令格式会受到支持" class="headerlink" title="如果命令扩展名被启用，额外的 FOR 命令格式会受到支持"></a>如果命令扩展名被启用，额外的 FOR 命令格式会受到支持</h3><p>a.</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FOR</span> /D %variable <span class="keyword">IN</span> (<span class="built_in">set</span>) <span class="keyword">DO</span> command [command-parameters]</span><br></pre></td></tr></table></figure><p>如果集里面包含通配符，则指定与目录名匹配，而不与文件名匹配。</p><p>b.</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FOR</span> /R [[drive:]<span class="built_in">path</span>] %variable <span class="keyword">IN</span> (<span class="built_in">set</span>) <span class="keyword">DO</span> command [command-parameters]</span><br></pre></td></tr></table></figure><p>检查以 [drive:]path 为根的目录树，指向每个目录中的FOR 语句。</p><p>如果在 /R 后没有指定目录，则使用当前目录。如果集仅为一个单点(.)字符，则枚举该目录树。</p><p>c.</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FOR</span> /L %variable <span class="keyword">IN</span> (<span class="built_in">start</span>,step,end) <span class="keyword">DO</span> command [command-parameters]</span><br></pre></td></tr></table></figure><p>该集表示以增量形式从开始到结束的一个数字序列。</p><p>如：(1,1,5) 将产生序列 1 2 3 4 5； 而(5,-1,1) 将产生序列 (5 4 3 2 1)。</p><p>d.有或者没有 usebackq 选项:</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FOR</span> /F ["options"] %variable <span class="keyword">IN</span> (file-<span class="built_in">set</span>) <span class="keyword">DO</span> command</span><br><span class="line"><span class="keyword">FOR</span> /F ["options"] %variable <span class="keyword">IN</span> ("string") <span class="keyword">DO</span> command</span><br><span class="line"><span class="keyword">FOR</span> /F ["options"] %variable <span class="keyword">IN</span> (command) <span class="keyword">DO</span> command</span><br></pre></td></tr></table></figure><p>参数”options”为:</p><ol><li>eol=c - 指一个行注释字符的结尾(就一个,如“;”)</li><li>skip=n - 指在文件开始时忽略的行数。</li><li>delims=xxx - 指分隔符集。这个替换了空格和跳格键的默认分隔符集。</li><li>tokens=x,y,m-n - 指每行的哪一个符号被传递到每个迭代的 for 本身。这会导致额外变量名称的分配。</li><li>m-n格式为一个范围。通过 nth 符号指定 mth。</li></ol><p>如果符号字符串中的最后一个字符星号，那么额外的变量将在最后一个符号解析之后分配并接受行的保留文本。</p><p>usebackq - 指定新语法已在下类情况中使用:</p><p>在作为命令执行一个后引号的字符串并且一个单引号字符为文字字符串命令并允许在 filenameset中使用双引号扩起文件名称。</p><ol><li>显示当前目录下所有以bat或者txt为扩展名的文件名</li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="variable">%%c</span> <span class="keyword">in</span> (*.bat *.txt) <span class="keyword">do</span> (<span class="built_in">echo</span> <span class="variable">%%c</span>)</span><br></pre></td></tr></table></figure><p>a. 显示当前目录下所有包含有 e 或者 i 的目录名</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /D <span class="variable">%%a</span> <span class="keyword">in</span> (*e* *i*) <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">%%a</span></span><br></pre></td></tr></table></figure><p>b. 显示 E盘test目录 下所有以bat或者txt为扩展名的文件名。</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /R E:\test <span class="variable">%%b</span> <span class="keyword">in</span> (*.txt *.bat) <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">%%b</span></span><br><span class="line"><span class="keyword">for</span> /r <span class="variable">%%c</span> <span class="keyword">in</span> (*) <span class="keyword">do</span> (<span class="built_in">echo</span> <span class="variable">%%c</span>) :: 遍历当前目录下所有文件</span><br></pre></td></tr></table></figure><p>c. 如下命令行将产生序列 1 2 3 4 5</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /L <span class="variable">%%c</span> <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">1</span>,<span class="number">5</span>) <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">%%c</span></span><br></pre></td></tr></table></figure><p>d. 以下两句，显示当前的年月日和时间</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">For</span> /f "tokens=<span class="number">1</span>-<span class="number">3</span> delims=-/. " <span class="variable">%%j</span> <span class="keyword">In</span> ('<span class="built_in">Date</span> /T') <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">%%j</span>年<span class="variable">%%k</span>月<span class="variable">%%l</span>日</span><br><span class="line"></span><br><span class="line"><span class="keyword">For</span> /f "tokens=<span class="number">1</span>,<span class="number">2</span> delims=: " <span class="variable">%%j</span> <span class="keyword">In</span> ('<span class="built_in">TIME</span> /T') <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">%%j</span>时<span class="variable">%%k</span>分</span><br></pre></td></tr></table></figure><p>e. 把记事本中的内容每一行前面去掉8个字符</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setlocal</span> enabledelayedexpansion</span><br><span class="line"><span class="keyword">for</span> /f <span class="variable">%%i</span> <span class="keyword">in</span> (zhidian.txt) <span class="keyword">do</span> (</span><br><span class="line"><span class="built_in">set</span> atmp=<span class="variable">%%i</span></span><br><span class="line"><span class="built_in">set</span> atmp=<span class="variable">!atmp:~8!</span></span><br><span class="line"><span class="keyword">if</span> &#123;<span class="variable">!atmp!</span>&#125;==&#123;&#125; ( <span class="built_in">echo</span>.) <span class="keyword">else</span> <span class="built_in">echo</span> <span class="variable">!atmp!</span></span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">REM 读取记事本里的内容(使用 delims 是为了把一行显示全,否则会以空格为分隔符)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> /f "delims=" <span class="variable">%%a</span> <span class="keyword">in</span> (zhidian.txt) <span class="keyword">do</span> <span class="built_in">echo</span>.<span class="variable">%%a</span></span><br></pre></td></tr></table></figure><h2 id="continue-和-break"><a href="#continue-和-break" class="headerlink" title="continue 和 break"></a>continue 和 break</h2><p>利用 goto 实现程序中常用的 continue 和 break 命令, 其实非常简单</p><ol><li><code>continue</code> 在 for 循环的最后一行写上一个标签，跳转到这位置即可</li><li><code>break</code> 在 for 循环的外面的下一句写上一个标签，跳转到这位置即可</li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /F ["options"] %variable <span class="keyword">IN</span> (command) <span class="keyword">DO</span> (</span><br><span class="line">... <span class="keyword">do</span> command ...</span><br><span class="line"><span class="keyword">if</span> ... <span class="keyword">goto</span> continue</span><br><span class="line"><span class="keyword">if</span> ... <span class="keyword">goto</span> <span class="built_in">break</span></span><br><span class="line">... <span class="keyword">do</span> command ...</span><br><span class="line">:continue</span><br><span class="line">)</span><br><span class="line">:<span class="built_in">break</span></span><br></pre></td></tr></table></figure><h1 id="其它命令"><a href="#其它命令" class="headerlink" title="其它命令"></a>其它命令</h1><h2 id="ping-命令"><a href="#ping-命令" class="headerlink" title="ping 命令"></a>ping 命令</h2><p>测试网络联接状况以及信息包发送和接收状况。但是不能够测试端口。</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ping</span> IP地址或主机名 [-t] [-a] [-n count] [-l size]</span><br></pre></td></tr></table></figure><p>参数含义：</p><ul><li>-t 不停地向目标主机发送数据；</li><li>-a 以IP地址格式来显示目标主机的网络地址；</li><li>-n count 指定要Ping多少次，具体次数由count来指定；</li><li>-l size 指定发送到目标主机的数据包的大小。</li></ul><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM 不停的测试192.168.0.1，按ctrl+c停止</span></span><br><span class="line"><span class="built_in">ping</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">0</span>.<span class="number">1</span> -t ()</span><br><span class="line"></span><br><span class="line"><span class="comment">REM ping一下所有的局域网电脑</span></span><br><span class="line"><span class="keyword">for</span> /L <span class="variable">%%a</span> <span class="keyword">in</span> (<span class="number">0</span>,<span class="number">1</span>,<span class="number">255</span>) <span class="keyword">do</span> <span class="built_in">ping</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">0</span>.<span class="variable">%%a</span> -n <span class="number">1</span> &gt;&gt; tmp.txt</span><br></pre></td></tr></table></figure><h2 id="telnet-命令"><a href="#telnet-命令" class="headerlink" title="telnet 命令"></a>telnet 命令</h2><p>测试端口使用 telnet IP地址或主机名 端口，使用tcp协议的</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet <span class="number">192</span>.<span class="number">168</span>.<span class="number">0</span>.<span class="number">1</span> <span class="number">80</span> (测试<span class="number">192</span>.<span class="number">168</span>.<span class="number">0</span>.<span class="number">1</span>的<span class="number">80</span>端口)</span><br></pre></td></tr></table></figure><h2 id="color-命令"><a href="#color-命令" class="headerlink" title="color 命令"></a>color 命令</h2><p>设置背景及字体颜色</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">color</span> bf</span><br></pre></td></tr></table></figure><p>b 是指定背景色的十六进制数字； f 指定前景颜色(即字体颜色)。</p><p>颜色值: 0:黑色 1:蓝色 2:绿色 3:湖蓝 4:红色 5:紫色 6:** 7:白色</p><p>8:灰色 9:淡蓝 A:淡绿 B:浅绿 C:淡红 D:淡紫 E:淡黄 F:亮白</p><p>如果没有给定任何参数，该命令会将颜色还原到 CMD.EXE 启动时的颜色。</p><p>如果两参数一样，视为无效输入。只有一个参数时，设置字体。</p><h2 id="random-命令"><a href="#random-命令" class="headerlink" title="random 命令"></a>random 命令</h2><p>产生随机数(正整数0~)</p><h2 id="exit-命令"><a href="#exit-命令" class="headerlink" title="exit 命令"></a>exit 命令</h2><p>结束程序。即时是被调用的程序，结束后也不会返回原程序</p><h2 id="shutdown命令"><a href="#shutdown命令" class="headerlink" title="shutdown命令"></a>shutdown命令</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM关机</span></span><br><span class="line">shutdown -s</span><br></pre></td></tr></table></figure><h1 id="字符串处理"><a href="#字符串处理" class="headerlink" title="字符串处理"></a>字符串处理</h1><h2 id="分割字符串，以查看时间为例"><a href="#分割字符串，以查看时间为例" class="headerlink" title="分割字符串，以查看时间为例"></a>分割字符串，以查看时间为例</h2><p>%源字符串:~起始值,截取长度% (起始值从0开始；截取长度是可选的，如果省略逗号和截取长度，将会从起始值截取到结尾；</p><p>截取长度如果是负数，表示截取到倒数第几个。)</p><ol><li><code>%time%</code> 显示如：”11:04:23.03” (完整的时间”hh:mm:ss.tt”)</li><li><code>%time:~0,5%</code> 显示”hh:mm”(即”11:04”)，其中0表示从右向左移位操作的个数，5表示从左向右移位操作的个数</li><li><code>%time:~0,8%</code> 显示标准时间格式”hh:mm:ss”(即”11:04:23”，前8个字符串)</li><li><code>%time:~3,-3%</code> 显示”mm:ss”(即从第4个开始,截去最后3个的字符串)</li><li><code>%time:~3%</code> 显示”04:23.03”(即去掉前4个字符串)</li><li><code>%time:~-3%</code> 显示”.tt”(即最后3个字符串)</li></ol><p>上面的字串分割格式，也可以用于其它地方，如目录路径：”%cd:~0,10%”</p><h2 id="替换字符串"><a href="#替换字符串" class="headerlink" title="替换字符串"></a>替换字符串</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> a="abcd1234"</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">%a%</span> 显示："abcd1234"</span><br><span class="line"><span class="built_in">set</span> a=<span class="variable">%a:1=kk%</span> 替换“<span class="number">1</span>”为“kk”</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">%a%</span> 显示："abcdkk234"</span><br></pre></td></tr></table></figure><h2 id="字符串合并"><a href="#字符串合并" class="headerlink" title="字符串合并"></a>字符串合并</h2><p>由于没有直接的字符串合并函数，只能用笨方法了。</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> str1=<span class="variable">%str1%</span><span class="variable">%str2%</span> (合并 str1 和 str2)</span><br></pre></td></tr></table></figure><h2 id="计算字符串长度"><a href="#计算字符串长度" class="headerlink" title="计算字符串长度"></a>计算字符串长度</h2><p>没有现成的函数。如下程序利用 goto形成循环，不断将字符串截短1，并记录截短的次数，到字符串变成空时的次数即长度。</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> testStr=This is a test string</span><br><span class="line"><span class="comment">REM 将 testStr 复制到str，str 是个临时字符串</span></span><br><span class="line"><span class="built_in">set</span> str=<span class="variable">%testStr%</span></span><br><span class="line"><span class="comment">REM 标签，用于goto跳转</span></span><br><span class="line">:next1</span><br><span class="line"><span class="comment">REM 判断str是不是空，如果不是则执行下边的语句</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> "<span class="variable">%str%</span>"=="" (</span><br><span class="line"><span class="comment">REM 算术运算，使num的值自增1，相当于num++或者++num语句</span></span><br><span class="line"><span class="built_in">set</span> /a num+=<span class="number">1</span></span><br><span class="line"><span class="comment">REM 截取字符串，每次截短1</span></span><br><span class="line"><span class="built_in">set</span> "str=<span class="variable">%str:~1%</span>"</span><br><span class="line"><span class="comment">REM 跳转到next1标签: 这里利用goto和标签，构成循环结构</span></span><br><span class="line"><span class="keyword">goto</span> next1</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">REM 当以上循环结构执行完毕时，会执行下边的语句</span></span><br><span class="line"><span class="built_in">echo</span> testStr=<span class="variable">%testStr%</span></span><br><span class="line"><span class="built_in">echo</span> testStr的长度为：<span class="variable">%num%</span></span><br></pre></td></tr></table></figure><h2 id="截取字符串时，需要传递参数"><a href="#截取字符串时，需要传递参数" class="headerlink" title="截取字符串时，需要传递参数"></a>截取字符串时，需要传递参数</h2><p>直接 echo %args:~%num%,-5% 没办法想要的字符串，需要如下两步</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setlocal</span> enabledelayedexpansion</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">!args:~%num%,-5!</span></span><br></pre></td></tr></table></figure><h1 id="注册表操作"><a href="#注册表操作" class="headerlink" title="注册表操作"></a>注册表操作</h1><h2 id="备份注册表"><a href="#备份注册表" class="headerlink" title="备份注册表"></a>备份注册表</h2><ul><li>将[HKEY_LOCAL_MACHINE … Run]的内容，备份到“c:\windows\1.reg”</li></ul><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg export HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run c:\windows\<span class="number">1</span>.reg</span><br><span class="line">reg export HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run c:\windows\<span class="number">2</span>.reg</span><br></pre></td></tr></table></figure><h2 id="修改-添加注册表内容"><a href="#修改-添加注册表内容" class="headerlink" title="修改/添加注册表内容"></a>修改/添加注册表内容</h2><ul><li>一般的添加或修改</li></ul><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add "HKCU\Environment" /v Java_Home /t reg_sz /d "D:\Java\jdk1.<span class="number">6</span>.<span class="number">0</span>_07" /f</span><br></pre></td></tr></table></figure><p>上句解析：“HKCU”是“HKEY_CURRENT_USER”的缩写，不用缩写用全称也可以；</p><p>添加名称为“Java_Home”的变量；类型为“reg_sz”，另一种常见类型是“reg_dword”；值为 D:\Java\jdk1.6.0_07；</p><h2 id="使用变量"><a href="#使用变量" class="headerlink" title="使用变量"></a>使用变量</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> SoftWareHome=HKEY_LOCAL_MACHINE\SOFTWARE\JavaSoft\Java</span><br><span class="line">reg add "<span class="variable">%SoftWareHome%</span>Web <span class="built_in">Start</span>\<span class="number">1</span>.<span class="number">6</span>.<span class="number">0</span>_07" /v Home /t reg_sz /d "<span class="variable">%cd%</span>\jre1.<span class="number">6</span>.<span class="number">0</span>_07\bin" /f</span><br></pre></td></tr></table></figure><h2 id="注册表的名称有空格，或者数据用特殊符号时"><a href="#注册表的名称有空格，或者数据用特殊符号时" class="headerlink" title="注册表的名称有空格，或者数据用特殊符号时"></a>注册表的名称有空格，或者数据用特殊符号时</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">reg add "<span class="variable">%SoftWareHome2%</span>\HelpCommands" /v "<span class="number">01</span>:Online Documentation" /t reg_sz /d "\"<span class="variable">%cd%</span>\Documentation\Index.htm\"" /f</span><br><span class="line"></span><br><span class="line"><span class="comment">REM 传入值为(值用双引号括起来的)："D:\ProgramFiles\1.work_soft\Sybase\PowerDesigner_12\Documentation\Index.htm"</span></span><br><span class="line">reg add "<span class="variable">%SoftWareHome2%</span>\Paths" /v ReportTemplates /t reg_sz /d "<span class="variable">%cd%</span>\Resource Files\Report Templates\\" /f</span><br><span class="line"></span><br><span class="line">传入值为(“\”结尾的)： E:\Holemar\<span class="number">1</span>.notes\<span class="number">90</span>. Windows\Resource Files\Report Templates\</span><br></pre></td></tr></table></figure><h2 id="增加空的内容"><a href="#增加空的内容" class="headerlink" title="增加空的内容"></a>增加空的内容</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Shared Tools\MSConfig\startupreg\IMJPMIG8.<span class="number">1</span>"</span><br></pre></td></tr></table></figure><h2 id="添加或修改默认值"><a href="#添加或修改默认值" class="headerlink" title="添加或修改默认值"></a>添加或修改默认值</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add "<span class="variable">%vpath%</span>InstallPath" /ve /t reg_sz /d "<span class="variable">%cd%</span>" /f</span><br></pre></td></tr></table></figure><p>这里用“/ve”来代替一般修改时的“/v 变量名”,即可修改默认值了</p><h2 id="删除注册表的内容"><a href="#删除注册表的内容" class="headerlink" title="删除注册表的内容"></a>删除注册表的内容</h2><p>双引号里面的是注册表的目录，下面两句将删除这目录下的所有信息</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg delete "HKEY_CURRENT_USER\Software\RealVNC" /f</span><br><span class="line">reg delete "HKEY_LOCAL_MACHINE\SOFTWARE\RealVNC" /f</span><br></pre></td></tr></table></figure><p>双引号里面的是注册表的目录，下面一句将删除这目录下指定的某个信息</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg delete "HKEY_LOCAL_MACHINE\Software\RealVNC" /v VNC_Server /f</span><br></pre></td></tr></table></figure><h2 id="注册表的常用位置"><a href="#注册表的常用位置" class="headerlink" title="注册表的常用位置"></a>注册表的常用位置</h2><p>系统启动项：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run]</span><br><span class="line">[HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run]</span><br><span class="line"><span class="function">example: <span class="title">REG</span> <span class="title">ADD</span> <span class="title">HKEY_LOCAL_MACHINE</span>\<span class="title">Software</span>\<span class="title">Microsoft</span>\<span class="title">Windows</span>\<span class="title">CurrentVersion</span>\<span class="title">Run</span> /<span class="title">v</span> <span class="title">VNC_Server</span> /<span class="title">t</span> <span class="title">REG_SZ</span> /<span class="title">d</span> "%<span class="title">cd</span>%\<span class="title">VNC_Server.bat</span>" /<span class="title">f</span></span></span><br></pre></td></tr></table></figure><h2 id="系统环境变量："><a href="#系统环境变量：" class="headerlink" title="系统环境变量："></a>系统环境变量：</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Environment]</span><br></pre></td></tr></table></figure><h2 id="当前用户的环境变量："><a href="#当前用户的环境变量：" class="headerlink" title="当前用户的环境变量："></a>当前用户的环境变量：</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[HKEY_CURRENT_USER\Environment]</span><br></pre></td></tr></table></figure><h2 id="刷新注册表"><a href="#刷新注册表" class="headerlink" title="刷新注册表"></a>刷新注册表</h2><p>修改注册表之后，结束并重新加载explorer.exe进程，可刷新注册表，令其生效</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">taskkill</span> /f /im explorer.exe &gt;<span class="built_in">nul</span></span><br><span class="line"><span class="built_in">start</span> "" "explorer.exe"</span><br></pre></td></tr></table></figure><h1 id="系统服务"><a href="#系统服务" class="headerlink" title="系统服务"></a>系统服务</h1><h2 id="停止-启动"><a href="#停止-启动" class="headerlink" title="停止/启动"></a>停止/启动</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM 停止服务</span></span><br><span class="line"><span class="built_in">NET</span> STOP 服务名</span><br><span class="line"></span><br><span class="line"><span class="comment">REM 启动服务</span></span><br><span class="line"><span class="built_in">NET</span> <span class="built_in">Start</span> 服务名</span><br></pre></td></tr></table></figure><h2 id="设置启动类型"><a href="#设置启动类型" class="headerlink" title="设置启动类型"></a>设置启动类型</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM 自动： </span></span><br><span class="line">SC CONFIG 服务名 <span class="built_in">START</span>= auto</span><br><span class="line"></span><br><span class="line"><span class="comment">REM 手动： </span></span><br><span class="line">SC CONFIG 服务名 <span class="built_in">START</span>= demand</span><br><span class="line"></span><br><span class="line"><span class="comment">REM 已禁用：</span></span><br><span class="line">SC CONFIG 服务名 <span class="built_in">START</span>= disabled</span><br></pre></td></tr></table></figure><p>附：“START= ”等号后面必须要有一个空格。(start还有boot,system两个值)</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM 打印机加载项，设置成手动，默认自动</span></span><br><span class="line">SC CONFIG Spooler <span class="built_in">START</span>= demand</span><br></pre></td></tr></table></figure><h2 id="查看系统服务："><a href="#查看系统服务：" class="headerlink" title="查看系统服务："></a>查看系统服务：</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">start</span> <span class="variable">%SystemRoot%</span>\system32\services.msc /s</span><br></pre></td></tr></table></figure><h1 id="setlocal与变量延迟"><a href="#setlocal与变量延迟" class="headerlink" title="setlocal与变量延迟"></a>setlocal与变量延迟</h1><p>在没有开启变量延迟的情况下，某条命令行中的变量改变，必须到下一条命令才能体现。另外例如for命令等，其后用一对圆括号闭合的所有语句也当作一行。</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> a=<span class="number">4</span></span><br><span class="line"><span class="built_in">set</span> a=<span class="number">5</span> &amp; <span class="built_in">echo</span> <span class="variable">%a%</span></span><br></pre></td></tr></table></figure><p>结果：4</p><p>也可以对这种机制加以利用，如下的变量交换</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> var1=abc</span><br><span class="line"><span class="built_in">set</span> var2=<span class="number">123</span></span><br><span class="line"><span class="built_in">echo</span> 交换前： var1=<span class="variable">%var1%</span> var2=<span class="variable">%var2%</span></span><br><span class="line"><span class="built_in">set</span> var1=<span class="variable">%var2%</span>&amp; <span class="built_in">set</span> var2=<span class="variable">%var1%</span></span><br><span class="line"><span class="built_in">echo</span> 交换后： var1=<span class="variable">%var1%</span> var2=<span class="variable">%var2%</span></span><br></pre></td></tr></table></figure><ul><li>启动批处理文件中环境变量的本地化。本地化将持续到出现匹配的 endlocal 命令或者到达批处理文件结尾为止。</li></ul><p>语法:</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setlocal</span> &#123;enableextension | disableextensions&#125; &#123;enabledelayedexpansion | disabledelayedexpansion&#125;</span><br></pre></td></tr></table></figure><ol><li><code>enableextension</code> 启用命令扩展，直到出现匹配的 endlocal 命令，无论 setlocal 命令之前的设置如何。</li><li><code>disableextensions</code> 禁用命令扩展，直到出现匹配的 endlocal 命令，无论 setlocal 命令之前的设置如何。</li><li><code>enabledelayedexpansion</code> 启用延迟的环境变量扩展，直到出现匹配的 endlocal 命令，无论 setlocal 命令之前的设置如何。</li><li><code>disabledelayedexpansion</code> 禁用延迟的环境变量扩展，直到出现匹配的 endlocal 命令，无论 setlocal 命令之前的设置如何。</li></ol><ul><li>为了能够感知环境变量的动态变化，批处理设计了变量延迟。简单来说，在读取了一条完整的语句之后，不立即对该行的变量赋值，而会在某个单条语句执行之前再进行赋值，也就是说“延迟”了对变量的赋值。</li></ul><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setlocal</span> enabledelayedexpansion</span><br><span class="line"><span class="built_in">set</span> a=<span class="number">4</span></span><br><span class="line"><span class="built_in">set</span> a=<span class="number">5</span> &amp; <span class="built_in">echo</span> <span class="variable">!a!</span></span><br></pre></td></tr></table></figure><p>结果： 5</p><p>变量延迟的启动语句是“setlocal enabledelayedexpansion”，并且变量要用一对叹号“!!”括起来</p><p>由于启动了变量延迟，所以批处理能够感知到动态变化，即不是先给该行变量赋值，而是在运行过程中给变量赋值，因此此时a的值就是5了</p><p>另外，启动变量延迟，“%”的变量还是不变</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setlocal</span> enabledelayedexpansion</span><br><span class="line"><span class="keyword">for</span> /l <span class="variable">%%i</span> <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">1</span>,<span class="number">5</span>) <span class="keyword">do</span> (</span><br><span class="line"><span class="built_in">set</span> a=<span class="variable">%%i</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">!a!</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>结果，打印从1到5；如果不变量延迟，一个变量也没有打印</p><h1 id="文件处理"><a href="#文件处理" class="headerlink" title="文件处理"></a>文件处理</h1><h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><ul><li>删除一个文件或多个文件</li></ul><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">del</span> /s /q /f d:\test\a.bat</span><br></pre></td></tr></table></figure><p>将直接删除d:\test\a.bat，没有任务提示</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">del</span> temp\* /q /f /s</span><br></pre></td></tr></table></figure><p>将直接删除 本目录的 temp 目录的所有文件，没有任务提示<br>删除文件的时候可以使用“*”作通配符</p><ul><li>删除一个空目录</li></ul><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rd</span> /q /s d:\test\log</span><br></pre></td></tr></table></figure><p>将直接删除d:\test\log目录，如果log目录里面有文件将无法删除</p><ul><li>删除一个非空目录 (必须指定目录名称)</li></ul><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rmdir</span> /q /s d:\test\logs</span><br></pre></td></tr></table></figure><p>必须指定目录名称，不能使用通配符</p><ol><li><code>/S</code> 除目录本身外，还将删除指定目录下的所有子目录</li><li><code>/Q</code> 安静模式，带 /S 删除目录树时不要求确认</li></ol><p>无论里面是否有文件或文件夹将全部直接删除</p><h2 id="创建目录"><a href="#创建目录" class="headerlink" title="创建目录"></a>创建目录</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">MKDIR</span> [drive:]<span class="built_in">path</span></span><br><span class="line"><span class="built_in">MD</span> [drive:]<span class="built_in">path</span></span><br></pre></td></tr></table></figure><p>路径有空格时，可以用双引号括起来，也可以用 &nbsp; 替代</p><h1 id="实践部分"><a href="#实践部分" class="headerlink" title="实践部分"></a>实践部分</h1><ol><li><p>调用其他程序时，对文件的大小写不敏感，文件后缀也可忽略,如：<code>start LeapFTP.exe</code> 与 <code>start leapftp</code> 效果一样，都是运行“LeapFTP.exe”文件。每行的开头的字符串会自动查找程序来运行，还可用双引号引起来(文件名或目录名含空格时必须用),如：”D:\Program Files\Leap FTP.exe” “LeapFTP.exe” 可正常运行文件，start “” “LeapFTP.exe” 也可以正常运行文件(注意，第一个参数是窗口显示的标题)</p></li><li><p><code>copy C:\test\*.* D:\back</code> (复制C盘test文件夹的所有文件(不包括文件夹及子文件夹里的东西)到D盘的back文件夹)</p></li><li><p><code>dir c:\*.* &gt; a.txt</code> (将c盘文件列表写入 a.txt 中)</p></li><li><p><code>&gt;</code> 生成文件并写入内容(如果有这文件则覆盖)，<code>&gt;&gt;</code> 文件里追加内容</p></li><li><p><code>md d:\aa</code> (创建文件夹)</p></li><li><p>在命令末尾加上 <code>&gt;NUL 2&gt;NUL</code>，表示隐蔽返回信息。</p></li><li><p>等待用户输入：set /p 变量名=屏幕显示信息</p></li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> /p pass=请输入密码:</span><br></pre></td></tr></table></figure><ol start="9"><li>让用户按回车退出,小技巧(替代pause)，文件的最后一句：</li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> /p tmp=操作结束，请按回车键退出...</span><br></pre></td></tr></table></figure><ol start="10"><li><p>设置标题： <code>title JDK安装</code></p></li><li><p>设置屏幕显示颜色，如绿色: <code>color 0a</code></p></li><li><p>清屏： <code>cls</code></p></li><li><p>查看自己的IP</p></li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /f "tokens=<span class="number">15</span>" <span class="variable">%%i</span> <span class="keyword">in</span> ('<span class="built_in">ipconfig</span> ^| <span class="built_in">find</span> /i "ip address"') <span class="keyword">do</span> <span class="built_in">set</span> ip=<span class="variable">%%i</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">%ip%</span> (这时的 <span class="variable">%ip%</span> 就是自己的IP地址)</span><br></pre></td></tr></table></figure><ol start="14"><li>修改文件的更新日期</li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">copy</span> 文件名+,,&gt;<span class="built_in">nul</span> (修改为当前时间，如果要修改为指定时间，先修改系统时间，再改回系统时间)</span><br></pre></td></tr></table></figure><ol start="15"><li>修改文件的后缀名</li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ren</span> C:\test\*.jpg *.JPG</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> /r <span class="variable">%%c</span> <span class="keyword">in</span> (*.jpg) <span class="keyword">do</span> (<span class="built_in">ren</span> <span class="variable">%%c</span> *.JPG) :: 修改当前目录下的所有文件的后缀名，包括子目录的</span><br></pre></td></tr></table></figure><ol start="16"><li>修改文件的文件名</li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rename</span> test.jpg test2.JPG</span><br><span class="line"><span class="built_in">rename</span> *.jpg *.<span class="number">888</span>.JPG</span><br></pre></td></tr></table></figure><ol start="17"><li>查看DNS、IP、Mac等</li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM Win08</span></span><br><span class="line">winipcfg</span><br><span class="line"></span><br><span class="line"><span class="built_in">Ipconfig</span> /all</span><br><span class="line"></span><br><span class="line">NSLOOKUP</span><br></pre></td></tr></table></figure><ol start="18"><li>查看IP上的共享资源，就可以</li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">net</span> view <span class="number">192</span>.<span class="number">168</span>.<span class="number">10</span>.<span class="number">8</span></span><br></pre></td></tr></table></figure><ol start="19"><li>共享</li></ol><p>A. 查看你机器的共享资源:</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">net</span> share</span><br></pre></td></tr></table></figure><p>B. 手工删除共享</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">net</span> share 共享资源名称$ /d</span><br></pre></td></tr></table></figure><p>注意$后有空格。</p><p>C. 增加一个共享：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">net</span> share mymovie=e:\downloads\movie /users:<span class="number">3</span></span><br></pre></td></tr></table></figure><p>mymovie 共享成功。 同时限制链接用户数为3人。</p><ol start="20"><li>打开某网站</li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">start</span> iexplore.exe http://www.baidu.com</span><br></pre></td></tr></table></figure><h1 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h1><ol><li>生成 reg 文件，运行它，再删除它</li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> "更改windows安装文件的路径"</span><br><span class="line"><span class="built_in">echo</span> Windows Registry Editor Version <span class="number">5</span>.<span class="number">00</span> &gt; c:\setupreg.reg</span><br><span class="line"><span class="built_in">echo</span> [HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Setup] &gt;&gt; c:\setupreg.reg</span><br><span class="line"><span class="built_in">echo</span> "ServicePackSourcePath"="D:\\Win2003\\" &gt;&gt; c:\setupreg.reg</span><br><span class="line"><span class="built_in">echo</span> "SourcePath"="D:\\Win2003\\" &gt;&gt; c:\setupreg.reg</span><br><span class="line"></span><br><span class="line"><span class="comment">REM 写入注册表</span></span><br><span class="line">regedit /S c:\setupreg.reg</span><br><span class="line"></span><br><span class="line"><span class="comment">REM 删除注册表文件</span></span><br><span class="line"><span class="built_in">del</span> c:\setupreg.reg</span><br></pre></td></tr></table></figure><ol start="2"><li>调用了exe文件,结束后没有关闭，解决方法:用start命令运行文件，如</li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">start</span> LeapFTP.exe <span class="number">192</span>.<span class="number">168</span>.<span class="number">0</span>.<span class="number">100</span></span><br></pre></td></tr></table></figure><ol start="3"><li>设置系统环境变量</li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM 有这个环境变量，则不需再设置，直接结束</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> "<span class="variable">%JAVA_HOME%</span>" == "" <span class="keyword">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment">REM 设置环境变量的地址</span></span><br><span class="line"><span class="built_in">set</span> inputJavaHome=<span class="variable">%cd%</span>\jdk1.<span class="number">6</span>.<span class="number">0</span>_07</span><br><span class="line"></span><br><span class="line"><span class="comment">REM 设置环境变量，也可以设置当前用户的变量</span></span><br><span class="line"><span class="built_in">set</span> EnvironmentHome=HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Environment</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> 正在设置环境变量，请稍候......</span><br><span class="line">reg add "<span class="variable">%EnvironmentHome%</span>" /v JAVA_HOME /t reg_sz /d "<span class="variable">%inputJavaHome%</span>" /f</span><br><span class="line">reg add "<span class="variable">%EnvironmentHome%</span>" /v ClassPath /t reg_sz /d ".;<span class="variable">%%J</span>AVA_HOME<span class="variable">%%\</span>lib" /f</span><br><span class="line">reg add "<span class="variable">%EnvironmentHome%</span>" /v <span class="built_in">Path</span> /t reg_sz /d "<span class="variable">%%J</span>AVA_HOME<span class="variable">%%\</span>bin;<span class="variable">%Path%</span>" /f]</span><br><span class="line"></span><br><span class="line"><span class="comment">REM 刷新，令环境变量生效</span></span><br><span class="line"><span class="built_in">taskkill</span> /f /im explorer.exe &gt;<span class="built_in">nul</span></span><br><span class="line"><span class="built_in">start</span> "" "explorer.exe"</span><br></pre></td></tr></table></figure><ol start="4"><li>隐藏某目录的所有文件及文件夹</li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /d 要隐藏的目录(如：D:)</span><br><span class="line"><span class="keyword">for</span> /f "usebackq delims=" <span class="variable">%%A</span> <span class="keyword">in</span> (`<span class="built_in">dir</span> /a /b`) <span class="keyword">do</span> (<span class="built_in">attrib</span> "<span class="variable">%%A</span>" -r +h -s)</span><br></pre></td></tr></table></figure><ol start="5"><li>在批处理中使用密码。密码为admin，输入正确，跳转到next1 ，若输入密码错误3次，则锁屏。</li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">set</span> num=<span class="number">0</span></span><br><span class="line">:<span class="number">11</span></span><br><span class="line"><span class="built_in">set</span> /p pass=请输入密码:</span><br><span class="line"><span class="keyword">if</span> "<span class="variable">%pass%</span>"=="admin" <span class="keyword">goto</span> next1</span><br><span class="line"><span class="built_in">set</span> /a num=<span class="variable">%num%</span> + <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> <span class="variable">%num%</span>==<span class="number">3</span> <span class="keyword">goto</span> no1</span><br><span class="line"><span class="keyword">goto</span> <span class="number">11</span></span><br><span class="line">:no1</span><br><span class="line"><span class="variable">%windir%</span>\system32\rundll32.exe user32.dll,LockWorkStation</span><br><span class="line"><span class="keyword">goto</span> <span class="number">11</span></span><br><span class="line">:next1</span><br><span class="line"><span class="built_in">echo</span> 密码正确，执行下面的程式</span><br><span class="line"><span class="built_in">pause</span></span><br></pre></td></tr></table></figure><ol start="6"><li>清空回收站(未成功)</li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"></span><br><span class="line"><span class="built_in">del</span> /f /s /q c:\recycler\*.*</span><br><span class="line"><span class="built_in">del</span> /f /s /q <span class="variable">%systemdrive%</span>\recycled\*.*</span><br><span class="line"></span><br><span class="line"><span class="comment">REM 新屏幕</span></span><br><span class="line"><span class="built_in">taskkill</span> /f /im explorer.exe &gt;<span class="built_in">nul</span></span><br><span class="line"><span class="built_in">start</span> "" "explorer.exe"</span><br></pre></td></tr></table></figure><ol start="7"><li>让系统断断续续地鸣叫</li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"></span><br><span class="line">:begin</span><br><span class="line"><span class="comment">REM 发出鸣叫(“”实际就是ASCII码值为7的特殊字符（蜂鸣键beep）</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="comment">REM 让程序暂停一小阵子</span></span><br><span class="line"><span class="built_in">ping</span> -n <span class="number">1</span> -l <span class="number">1</span> <span class="number">127</span>.<span class="number">1</span>&gt;<span class="built_in">nul</span></span><br><span class="line"><span class="keyword">goto</span> :begin</span><br></pre></td></tr></table></figure><ol start="8"><li>将 FAT 卷转换成 NTFS</li></ol><p>利用“CONVERT.exe”进行,解析如下：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CONVERT</span> volume /<span class="built_in">FS</span>:NTFS [/V] [/CvtArea:filename] [/NoSecurity] [/X]</span><br></pre></td></tr></table></figure><ul><li><code>volume</code> 指定驱动器号(后面跟一个冒号)、装载点或卷名</li><li><code>/FS:NTFS</code> 指定要被转换成 NTFS 的卷</li><li><code>/V</code> 指定 Convert 应该用详述模式运行</li><li><code>/CvtArea:filename</code>将根目录中的一个接续文件指定为NTFS 系统文件的占位符</li><li><code>/NoSecurity</code> 指定每个人都可以访问转换的文件和目录的安全设置</li><li><code>/X</code> 如果必要，先强行卸载卷。该卷的所有打开的句柄则无效</li></ul><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@ <span class="built_in">ECHO</span> OFF</span><br><span class="line">@ <span class="built_in">ECHO</span>.</span><br><span class="line">@ <span class="built_in">ECHO</span>. 说 明</span><br><span class="line">@ <span class="built_in">ECHO</span> --------------------------------------------------------------------------</span><br><span class="line">@ <span class="built_in">ECHO</span> NTFS是一种磁盘格式。该格式能存放大于<span class="number">4</span>G的单个文件(如高清电影文件)，并可对</span><br><span class="line">@ <span class="built_in">ECHO</span> 文件夹进行加密，但有个缺点是DOS下无法访问。建议D盘及其后的盘使用NTFS格式，</span><br><span class="line">@ <span class="built_in">ECHO</span> C盘如非必要可以不转换，FAT32与NTFS这两种格式的读写速度几乎是没有差别的。</span><br><span class="line">@ <span class="built_in">ECHO</span> --------------------------------------------------------------------------</span><br><span class="line">@ <span class="built_in">ECHO</span>.</span><br><span class="line"></span><br><span class="line"><span class="built_in">convert</span> c: /<span class="built_in">fs</span>:ntfs</span><br><span class="line"><span class="comment">REM D盘也转成 NTFS</span></span><br><span class="line"><span class="built_in">convert</span> d: /<span class="built_in">fs</span>:ntfs</span><br></pre></td></tr></table></figure><ol start="9"><li>获取我的文档</li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SET</span> SF="HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders"</span><br><span class="line"></span><br><span class="line"><span class="keyword">FOR</span> /F "tokens=<span class="number">2</span>,*" <span class="variable">%%I</span> <span class="keyword">IN</span> ('REG QUERY <span class="variable">%SF%</span> /v Personal <span class="number">2</span>^&gt;<span class="built_in">NUL</span>^|<span class="built_in">FIND</span> /I "Personal"') <span class="keyword">DO</span> <span class="built_in">SET</span> "myDoc=<span class="variable">%%~</span>J"</span><br><span class="line"></span><br><span class="line"><span class="comment">REM 复制文件到我的文档</span></span><br><span class="line"><span class="built_in">XCOPY</span> /D /E /R /Y /C "<span class="variable">%cd%</span>\test.txt" "<span class="variable">%myDoc%</span>\test\"</span><br></pre></td></tr></table></figure><p>10 获取当前目录路径</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ./</span><br><span class="line"><span class="built_in">set</span> CURR_PATH=<span class="variable">%cd%</span></span><br></pre></td></tr></table></figure><ol start="11"><li>IF-ERRORLEVEL</li></ol><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">ECHO</span> OFF</span><br><span class="line"><span class="built_in">XCOPY</span> C:\AUTOEXEC.BAT D:<span class="keyword">IF</span> <span class="keyword">ERRORLEVEL</span> <span class="number">1</span> <span class="built_in">ECHO</span> 文件拷贝失败</span><br><span class="line"><span class="keyword">IF</span> <span class="keyword">ERRORLEVEL</span> <span class="number">0</span> <span class="built_in">ECHO</span> 成功拷贝文件</span><br></pre></td></tr></table></figure><p>如果文件拷贝成功，屏幕就会显示“成功拷贝文件”，否则就会显示“文件拷贝失败”。</p><p><code>IF ERRORLEVEL</code> 是用来测试它的上一个DOS命令的返回值的，注意只是上一个命令的返回值，而且返回值必须依照从大到小次序顺序判断。因此下面的批处理文件是错误的：</p><hr><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off //不显示shell的命令。</span><br><span class="line"><span class="built_in">Setlocal</span> //环境改变只适用于这个文件。</span><br><span class="line"><span class="variable">%OS%</span> //为当前的操作系统。</span><br><span class="line"><span class="comment">Rem //注释一行文本。</span></span><br><span class="line"><span class="keyword">Goto</span> 标签 //改变执行顺序，去标签位置.</span><br><span class="line">：标签 //定义一个标签。</span><br><span class="line"><span class="built_in">Set</span> 变量名=值 //定义变量</span><br><span class="line"><span class="keyword">Not</span> //取反</span><br><span class="line">Netstat –na //显示当前被点用的端口.</span><br><span class="line">%<span class="number">0</span> %<span class="number">1</span> %<span class="number">2</span> //用于表示批处理文件的参数<span class="number">0</span>为命令,共<span class="number">1</span>-<span class="number">9</span>个参数。</span><br><span class="line"><span class="built_in">Shift</span> //用于向前一个参数，原<span class="number">1</span>变<span class="number">0</span>，原<span class="number">2</span>变<span class="number">1</span>.每调用一次<span class="built_in">shift</span>向前一移动一位。</span><br><span class="line"><span class="keyword">Call</span> //调用其他批处理文件或命令。</span><br><span class="line"><span class="built_in">Start</span> 命令 参数 //指示出在另一个窗口中开始运行命令。</span><br></pre></td></tr></table></figure><hr><ul><li>自动设置Java环境变量</li></ul><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="keyword">IF</span> <span class="keyword">EXIST</span> %<span class="number">1</span>\bin\java.exe (</span><br><span class="line"><span class="comment">rem 如输入正确的 Java2SDK 安装目录，开始设置环境变量</span></span><br><span class="line">@setx JAVA_HOME %<span class="number">1</span></span><br><span class="line">@setx <span class="built_in">path</span> <span class="variable">%path%</span>;<span class="variable">%JAVA_HOME%</span>\bin</span><br><span class="line">@setx classpath <span class="variable">%classpath%</span>;.</span><br><span class="line">@setx classpath <span class="variable">%classpath%</span>;<span class="variable">%JAVA_HOME%</span>\lib\tools.jar</span><br><span class="line">@setx classpath <span class="variable">%classpath%</span>;<span class="variable">%JAVA_HOME%</span>\lib\dt.jar</span><br><span class="line">@setx classpath <span class="variable">%classpath%</span>;<span class="variable">%JAVA_HOME%</span>\jre\lib\rt.jar</span><br><span class="line">@<span class="built_in">echo</span> on</span><br><span class="line">@<span class="built_in">echo</span> Java <span class="number">2</span> SDK 环境参数设置完毕，正常退出。</span><br><span class="line">) <span class="keyword">ELSE</span> (</span><br><span class="line"><span class="keyword">IF</span> "%<span class="number">1</span>"=="" (</span><br><span class="line"><span class="comment">rem 如没有提供安装目录，提示之后退出</span></span><br><span class="line">@<span class="built_in">echo</span> on</span><br><span class="line">@<span class="built_in">echo</span> 没有提供 Java2SDK 的安装目录,不做任何设置，现在退出环境变量设置。</span><br><span class="line">) <span class="keyword">ELSE</span> (</span><br><span class="line"><span class="comment">rem 如果提供非空的安装目录但没有bin\java.exe，则指定的目录为错误的目录</span></span><br><span class="line">@<span class="built_in">echo</span> on</span><br><span class="line">@<span class="built_in">echo</span> 非法的 Java2SDK 的安装目录,不做任何设置，现在退出环境变量设置。</span><br><span class="line">)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><hr><p>本文部分内容转载自：<a href="http://m18333611647.blog.163.com/blog/static/225533041201422111365439/" target="_blank" rel="noopener">http://m18333611647.blog.163.com/blog/static/225533041201422111365439/</a></p></div><blockquote class="post-copyright"><div class="content"><span class="post-time">最后更新时间：<time datetime="2020-04-28T06:08:18.000Z" itemprop="dateUpdated">2020-04-28 14:08:18</time></span><br>本文链接：<a href="/posts/Batch.html" target="_blank" rel="external">https://vitan.me/posts/Batch.html</a></div><footer><a href="https://vitan.me"><img src="/img/ivitan.png" alt="Vitan"> Vitan</a></footer></blockquote><div class="page-reward"><a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a></div><div class="post-footer"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Batch/" rel="tag">Batch</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Windows/" rel="tag">Windows</a></li></ul></div></div><nav class="post-nav flex-row flex-justify-between"><div class="waves-block waves-effect prev"><a href="/posts/WinTask.html" id="post-prev" class="post-nav-link"><div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div><h4 class="title">Batch 计划任务</h4></a></div><div class="waves-block waves-effect next"><a href="/posts/OpenSourceSearch.html" id="post-next" class="post-nav-link"><div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div><h4 class="title">如何高效寻找开源项目</h4></a></div></nav><div class="comments vcomment" id="comments"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var GUEST_INFO=["nick","mail","link"],guest_info="nick,mail,link".split(",").filter(function(e){return-1<GUEST_INFO.indexOf(e)});new Valine({el:"#comments",notify:!1,verify:!1,appId:"D33WPBHpBw2CjwdWpFvpUhDm-MdYXbMMI",appKey:"MzQtKvSeVPU4nS4ljd3zlbMp",avatar:"wavatar",placeholder:"Write a comment here.",guest_info:0==guest_info.length?GUEST_INFO:guest_info,pageSize:"10"})</script></article><div id="reward" class="page-modal reward-lay"><a class="close" href="javascript:;"><i class="icon icon-close"></i></a><h3 class="reward-title"><i class="icon icon-quote-left"></i> 感谢支持！ <i class="icon icon-quote-right"></i></h3><div class="reward-content"><div class="reward-code"><img id="rewardCode" src="/img/wechat.png" alt="打赏二维码"></div><label class="reward-toggle"><input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/wechat.png" data-alipay="/img/alipay.png"><div class="reward-toggle-ctrol"><span class="reward-toggle-item wechat">微信</span> <span class="reward-toggle-label"></span> <span class="reward-toggle-item alipay">支付宝</span></div></label></div></div><script src="//unpkg.com/jquery@latest/dist/jquery.min.js"></script><script src="/js/clipboard.min.js?v=1.7.2"></script><script src="/js/copy.min.js?v=1.7.2"></script></div><footer class="footer"><div class="top"><p><span id="busuanzi_container_site_uv" style="display:none"><i class="icon icon-lg icon-user"></i><span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" style="display:none"><i class="icon icon-lg icon-eye"></i><span id="busuanzi_value_site_pv"></span></span></p><p><span><a href="/xml/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span> <span>内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 协议</a></span></p></div><div class="bottom"><p><span>Vitan &copy; 2017 - 2020</span> <span>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/ivitan/indigo" target="_blank">indigo</a></span></p></div></footer></main><div class="mask" id="mask"></div><a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a><script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script><script>var BLOG={ROOT:"/",SHARE:!1,REWARD:!0}</script><script src="/js/main.min.js?v=1.7.2"></script><div class="search-panel" id="search-panel"><ul class="search-result" id="search-result"></ul></div><template id="search-tpl"><li class="item"><a href="{path}" class="waves-block waves-effect"><div class="title ellipsis" title="{title}">{title}</div><div class="flex-row flex-middle"><div class="tags ellipsis">{tags}</div><time class="flex-col time">{date}</time></div></a></li></template><script src="/js/search.min.js?v=1.7.2" async></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>