<!DOCTYPE html><html lang="zh-CN"><head>
<script>(n=>{"use strict";let r,s,e;const l=["cdn.jsdelivr.net","fastly.jsdelivr.net","gcore.jsdelivr.net","cdn.zenless.top","testingcf.jsdelivr.net","test1.jsdelivr.net"],t="//",a=l[0],i=Date.now(),o=2e3,c="jsdelivr-auto-fallback",f="/gh/PipecraftNet/jsdelivr-auto-fallback@main/empty.css?",d=e=>e&&e.includes(t+a),m=e=>e.replace(t+a,t+r),u=window.setTimeout,v=n.querySelectorAll.bind(n),g=()=>{let e,t;for(e of v('link[rel="stylesheet"]'))t=e.href,d(t)&&!t.includes(f)&&(e.href=m(t));for(e of v("script"))if(t=e.src,d(t)){const r=n.createElement("script");r.src=m(t),e.defer=!0,e.src="",e.before(r),e.remove()}for(e of v("img"))t=e.src,d(t)&&(e.src="",e.src=m(t));for(e of v("*[style]"))t=e.getAttribute("style"),d(t)&&e.setAttribute("style",m(t));for(e of v("style"))t=e.innerHTML,d(t)&&(e.innerHTML=m(t))},y=()=>{!e&&s&&r&&(console.warn(a+" is not available. Use "+r),e=!0,u(g,0),u(g,20),setInterval(g,500))},b=(()=>{try{return Object.assign({},JSON.parse(localStorage.getItem(c)||"{}"))}catch{return{}}})();var h=()=>{b.time=i,b.failed=!1,b.fastNode=null;for(const t of l)((e,t)=>{let r;const s=n.createElement("link"),l=e=>{r&&(clearTimeout(r),r=0,e||(s.href="data:text/plain;base64,"),s.remove(),t(e))};r=u(l,o),s.addEventListener("error",()=>l(!1)),s.addEventListener("load",()=>l(!0)),s.rel="stylesheet",s.text="text/css",s.href=e+f+i,n.head.insertAdjacentElement("afterbegin",s)})("https://"+t,e=>{e||t!==a||(s=!0,b.failed=!0),e&&!r&&(r=t),e&&!b.fastNode&&(b.fastNode=t),y()});u(()=>{s&&!r&&(r=l[1],y()),localStorage.setItem(c,JSON.stringify(b))},o+100)};b.time&&i-b.time<36e5&&b.failed&&b.fastNode?(s=!0,r=b.fastNode,y(),u(h,1e3)):h()})(document);</script><meta name="generator" content="Hexo 5.4.2"><meta charset="utf-8"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://fastly.jsdelivr.net"><link rel="preconnect" href="https://fastly.jsdelivr.net" crossorigin><link rel="dns-prefetch" href="//unpkg.com"><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#f8f8f8"><title>Shell - 楊咩阿</title><meta name="description" content="Shell 总结"><meta property="og:type" content="article"><meta property="og:title" content="Shell"><meta property="og:url" content="https://ivitan.com/posts/Shell.html"><meta property="og:site_name" content="楊咩阿"><meta property="og:description" content="Shell 总结"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720191523.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720191707.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720192503.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720194539.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720195605.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720200443.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720200649.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720201000.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720201134.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720205155.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721094218.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721094721.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721094812.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721095810.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721100028.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721100852.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721100931.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721102519.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721103230.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721103352.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721104309.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721124926.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721125045.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721130039.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721134349.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721134554.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721185930.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721191406.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721191743.png"><meta property="article:published_time" content="2019-07-20T10:59:04.000Z"><meta property="article:modified_time" content="2022-10-16T02:09:43.732Z"><meta property="article:author" content="VITAN"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Shell"><meta property="article:tag" content="Bash"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720191523.png"><link rel="alternate" href="/xml/atom.xml" title="楊咩阿" type="application/atom+xml"><link rel="stylesheet" href="/css/main.css"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/ivitan/Picture@master/images/favicon.svg"><script defer async src="https://www.googletagmanager.com/gtag/js?id=G-XEHQ8YBEN0"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XEHQ8YBEN0")</script></head><body><div class="l_body" id="start"><aside class="l_left" layout="post"><header class="header"><div class="logo-wrap"><a class="avatar" href="/"><div class="bg" style="opacity:0;background-image:url(https://fastly.jsdelivr.net/gh/cdn-x/placeholder@1.0.2/avatar/round/rainbow64@3x.webp)"></div><img no-lazy class="avatar" src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/ivitan.png" onerror="javascript:this.classList.add('error');this.src='https://fastly.jsdelivr.net/gh/cdn-x/placeholder@1.0.1/image/2659360.svg';"></a><a class="title" href="/"><div class="main">楊咩阿</div><div class="sub normal cap">⁣⁣⁣Never Settle</div><div class="sub hover cap" style="opacity:0">ivitan.com</div></a></div><nav class="menu dis-select"><a class="nav-item active" href="/">主页</a><a class="nav-item" href="/wiki/">项目</a><a class="nav-item" href="/about/">关于</a></nav></header><div class="widgets"><div class="widget-wrap single" id="toc"><div class="widget-header cap dis-select"><span class="name">本文目录</span></div><div class="widget-body fs14"><div class="doc-tree active"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E6%9B%BF%E6%8D%A2"><span class="toc-text">变量替换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E6%B5%8B%E8%AF%95"><span class="toc-text">变量测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%95%BF%E5%BA%A6"><span class="toc-text">计算字符串长度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%90%E4%B8%B2"><span class="toc-text">子串</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%8B%E9%A2%98"><span class="toc-text">例题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#declare-%E5%92%8C-typeset-%E5%91%BD%E4%BB%A4"><span class="toc-text">declare 和 typeset 命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#declare%E5%8F%82%E6%95%B0%E8%A1%A8"><span class="toc-text">declare参数表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%96%E6%B6%88%E5%A3%B0%E6%98%8E%E7%9A%84%E5%8F%98%E9%87%8F"><span class="toc-text">取消声明的变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-text">例子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bc-%E6%93%8D%E4%BD%9C"><span class="toc-text">bc 操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="toc-text">函数定义和使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%B0%83%E7%94%A8"><span class="toc-text">如何调用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%8B%E9%A2%98-1"><span class="toc-text">例题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shell%E4%BC%A0%E5%8F%82"><span class="toc-text">shell传参</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-text">函数返回值</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#reutrn-%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-text">reutrn 返回值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#echo-%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-text">echo 返回值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="toc-text">全局变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F"><span class="toc-text">局部变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BA%93"><span class="toc-text">函数库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B"><span class="toc-text">实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%89%E9%A1%B9"><span class="toc-text">选项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#locate"><span class="toc-text">locate</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#whereis%E9%80%89%E9%A1%B9%E5%92%8C%E5%90%AB%E4%B9%89"><span class="toc-text">whereis选项和含义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#which"><span class="toc-text">which</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%84%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E6%8E%A8%E8%8D%90"><span class="toc-text">各命令使用场景推荐</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#grep"><span class="toc-text">grep</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#egrep"><span class="toc-text">egrep</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-text">语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%89%E9%A1%B9-1"><span class="toc-text">选项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sed-%E7%9A%84-pattern-%E8%AF%A6%E8%A7%A3"><span class="toc-text">sed 的 pattern 详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sed-%E4%B8%AD%E7%9A%84%E7%BC%96%E8%BE%91%E5%91%BD%E4%BB%A4"><span class="toc-text">sed 中的编辑命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%90%91%E5%BC%95%E7%94%A8"><span class="toc-text">反向引用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sed-%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F"><span class="toc-text">sed 引用变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8-sed-%E6%9F%A5%E8%AF%A2%E7%89%B9%E5%AE%9A%E5%86%85%E5%AE%B9"><span class="toc-text">用 sed 查询特定内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sed-%E5%88%A0%E9%99%A4%E7%89%B9%E5%AE%9A%E5%86%85%E5%AE%B9"><span class="toc-text">sed 删除特定内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sed-%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="toc-text">sed 修改文件内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sed-%E8%BF%BD%E5%8A%A0%E6%96%87%E6%9C%AC%E5%86%85%E5%AE%B9"><span class="toc-text">sed 追加文本内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#awk-%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-text">awk 的工作模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-1"><span class="toc-text">语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#awk-%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F"><span class="toc-text">awk 内置变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#awk-%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA"><span class="toc-text">awk 格式化输出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#awk%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D%E7%9A%84%E4%B8%A4%E7%A7%8D%E7%94%A8%E6%B3%95"><span class="toc-text">awk模式匹配的两种用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#awk-%E5%8A%A8%E4%BD%9C%E4%B8%AD%E7%9A%84%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%94%A8%E6%B3%95"><span class="toc-text">awk 动作中的表达式用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#awk-%E5%8A%A8%E4%BD%9C%E4%B8%AD%E7%9A%84%E6%9D%A1%E4%BB%B6%E5%8F%8A%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5"><span class="toc-text">awk 动作中的条件及循环语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#awk-%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-text">awk 中的字符串函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#awk%E4%B8%AD%E7%9A%84%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9"><span class="toc-text">awk中的常用选项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shell-%E6%95%B0%E7%BB%84%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-text">Shell 数组的用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#awk-%E6%95%B0%E7%BB%84%E7%94%A8%E6%B3%95"><span class="toc-text">awk 数组用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#awk-%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE%E4%BE%8B%E5%AD%90"><span class="toc-text">awk 处理数据例子</span></a></li></ol></div></div></div></div><footer class="footer dis-select"><div class="social-wrap"><a class="social" href="https://github.com/ivitan" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/cdn-x/placeholder@1.0.3/social/08a41b181ce68.svg"></a></div></footer></aside><div class="l_main"><div class="bread-nav fs12"><div id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a><span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/Coding/">Coding</a></div><div id="post-meta">发布于&nbsp;<time datetime="2019-07-20T10:59:04.000Z">2019-07-20</time></div></div><article class="content md post"><h1 class="article-title"><span>Shell</span></h1><p>Shell 总结</p><span id="more"></span><h1 id="变量替换和测试"><a href="#变量替换和测试" class="headerlink" title="变量替换和测试"></a>变量替换和测试</h1><h2 id="变量替换"><a href="#变量替换" class="headerlink" title="变量替换"></a>变量替换</h2><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720191523.png"></p><h2 id="变量测试"><a href="#变量测试" class="headerlink" title="变量测试"></a>变量测试</h2><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720191707.png"></p><h1 id="字符串处理"><a href="#字符串处理" class="headerlink" title="字符串处理"></a>字符串处理</h1><h2 id="计算字符串长度"><a href="#计算字符串长度" class="headerlink" title="计算字符串长度"></a>计算字符串长度</h2><p>方法一</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;#string&#125;</span></span><br></pre></td></tr></table></figure><p>方法二</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">expr</span> length <span class="string">&quot;<span class="variable">$string</span>&quot;</span></span><br></pre></td></tr></table></figure><ul><li>string 有空格，则必须加双引号</li></ul><h2 id="子串"><a href="#子串" class="headerlink" title="子串"></a>子串</h2><p>获取子串在字符串中的索引位置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">expr</span> index <span class="variable">$string</span> <span class="variable">$substring</span></span><br></pre></td></tr></table></figure><p>抽取子串</p><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720192503.png"></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>计算字符串长度</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var1=<span class="string">&quot;This is a app&quot;</span></span><br><span class="line">len=<span class="variable">$&#123;#$var1&#125;</span></span><br><span class="line">len=`<span class="built_in">expr</span> length <span class="string">&quot;<span class="variable">$var1</span>&quot;</span>`</span><br></pre></td></tr></table></figure><p>子串索引</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var1=<span class="string">&quot;quicstart is a app&quot;</span></span><br><span class="line">ind=`<span class="built_in">expr</span> index <span class="string">&quot;<span class="variable">$var1</span>&quot;</span> start`</span><br></pre></td></tr></table></figure><p>子串长度</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var1=<span class="string">&quot;quicstart is a app&quot;</span></span><br><span class="line">ind=`<span class="built_in">expr</span> match <span class="string">&quot;$<span class="variable">$var1</span>&quot;</span> app`</span><br></pre></td></tr></table></figure><p>抽取字符串中的子串</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var1=<span class="string">&quot;quicstart is a app&quot;</span></span><br><span class="line">substr1=<span class="variable">$&#123;var1:10&#125;</span></span><br><span class="line">substr2=<span class="variable">$&#123;var1:10:6&#125;</span></span><br><span class="line">substr1=<span class="variable">$&#123;var1:-5&#125;</span></span><br><span class="line">substr1=<span class="variable">$&#123;var1:-10:4&#125;</span></span><br></pre></td></tr></table></figure><ul><li>expr 索引1开始,${string:position}从0开始</li></ul><p>实例</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line">string=<span class="string">&quot;Bigdata process framework is Hadoop,Hadoop is an open source project&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> print_tips</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;***********************&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;(1) 打印string长度&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;(2) 删除字符串中所有Hadoop&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;(3) 替换第一个Hadoop为Mapreduce&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;(4) 替换全部Hadoop为Mapreduce&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;**********************&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> len_of_string</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;#string&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> del_hadoop</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;string/Hadoop/&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> rep_hadoop_mapreduce_first</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;string/Hadoop/Mapreduce&#125;</span>&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> rep_hadoop_mapreduce_all</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;string//Hadoop/Mapreduce&#125;</span>&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;【string=<span class="variable">$string</span>】&quot;</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  print_tips</span><br><span class="line">  <span class="built_in">read</span> -p <span class="string">&quot;Pls input your choice(1|2|3|4|q|Q):&quot;</span> choice</span><br><span class="line">  <span class="keyword">case</span> <span class="variable">$choice</span> <span class="keyword">in</span></span><br><span class="line">        1)  len_of_string</span><br><span class="line">            ;;</span><br><span class="line">        2)  del_hadoop</span><br><span class="line">            ;;</span><br><span class="line">        3)  rep_hadoop_mapreduce_first</span><br><span class="line">            ;;</span><br><span class="line">        4)  rep_hadoop_mapreduce_all</span><br><span class="line">            ;;</span><br><span class="line">        q|Q)  <span class="built_in">exit</span></span><br><span class="line">              ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Error,input only in &#123;1|2|3|4|q|Q&#125;&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h1 id="命令替换"><a href="#命令替换" class="headerlink" title="命令替换"></a>命令替换</h1><p>语法格式</p><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720194539.png"></p><h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><p>获取系统所有用户并输出</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/passwd | <span class="built_in">cut</span> -d “:” -^C <span class="comment">#分割的第一个</span></span><br><span class="line"><span class="built_in">cat</span> /etc/passwd | <span class="built_in">cut</span> -d “:” -f 1 <span class="comment">#分段</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"><span class="comment"># 判断进程是否存在，否则启动</span></span><br><span class="line">nginx_process_num=$(ps -ef | grep nginx | grep -v grep | <span class="built_in">wc</span> -l)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$nginx_process_num</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">    systemctl start nginx</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p><code>\</code>`<code>和</code>$()&#96;</p><ol><li>&#96;&#96;和$()是等价的，但初学推荐$()</li><li>$(())用于进行整数运算，包括加减乘除</li><li>$(((100 + 30) &#x2F; 12))</li></ol><h1 id="有类型变量"><a href="#有类型变量" class="headerlink" title="有类型变量"></a>有类型变量</h1><h2 id="declare-和-typeset-命令"><a href="#declare-和-typeset-命令" class="headerlink" title="declare 和 typeset 命令"></a>declare 和 typeset 命令</h2><p>两者关系:两者等价，都是用来定义变量类型</p><h2 id="declare参数表"><a href="#declare参数表" class="headerlink" title="declare参数表"></a>declare参数表</h2><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720195605.png"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 声明整数型变量</span></span><br><span class="line"><span class="built_in">declare</span> -i ab <span class="comment">#声明整数型变量</span></span><br><span class="line">ab=56 <span class="comment">#改变变量内容</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$ab</span> <span class="comment">#显示变量内容</span></span><br><span class="line">56</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改变变量属性</span></span><br><span class="line"><span class="built_in">declare</span> -i ef <span class="comment">#声明整数型变量</span></span><br><span class="line">ef=1  <span class="comment">#变量赋值（整数值）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$ef</span> <span class="comment">#显示变量内容</span></span><br><span class="line">1</span><br><span class="line">ef=<span class="string">&quot;wer&quot;</span> <span class="comment">#变量赋值（文本值）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$ef</span> </span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"><span class="built_in">declare</span> +i ef <span class="comment">#取消变量属性</span></span><br><span class="line">ef=<span class="string">&quot;wer&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$ef</span></span><br><span class="line">wer</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置变量只读</span></span><br><span class="line"><span class="built_in">declare</span> -r ab <span class="comment">#设置变量为只读</span></span><br><span class="line">ab=88 <span class="comment">#改变变量内容</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$ab</span> <span class="comment">#显示变量内容</span></span><br><span class="line">56</span><br><span class="line"></span><br><span class="line"><span class="comment"># 声明数组变量</span></span><br><span class="line"><span class="built_in">declare</span> -a <span class="built_in">cd</span>=<span class="string">&#x27;([0]=&quot;a&quot; [1]=&quot;b&quot; [2]=&quot;c&quot;)&#x27;</span> <span class="comment">#声明数组变量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;cd[1]&#125;</span></span><br><span class="line">b <span class="comment">#显示变量内容</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;cd[@]&#125;</span> <span class="comment">#显示整个数组变量内容</span></span><br><span class="line">a b c</span><br></pre></td></tr></table></figure><ul><li><code>declare -x</code> 声明为环境变量，可在脚本中直接使用</li></ul><h2 id="取消声明的变量"><a href="#取消声明的变量" class="headerlink" title="取消声明的变量"></a>取消声明的变量</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">declare</span> +r</span><br><span class="line"><span class="built_in">declare</span> +i</span><br><span class="line"><span class="built_in">declare</span> +a</span><br><span class="line"><span class="built_in">declare</span> +X</span><br></pre></td></tr></table></figure><h1 id="数学运算"><a href="#数学运算" class="headerlink" title="数学运算"></a>数学运算</h1><p>语法格式<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720200443.png"></p><p>expr操作符对照表<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720200649.png"></p><h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720201000.png"></p><h1 id="Bash运算之bc"><a href="#Bash运算之bc" class="headerlink" title="Bash运算之bc"></a>Bash运算之bc</h1><h2 id="bc-操作"><a href="#bc-操作" class="headerlink" title="bc 操作"></a>bc 操作</h2><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720201134.png"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scale=2 <span class="comment">#精确到小数点后两位</span></span><br><span class="line"><span class="built_in">echo</span> “20+22” | bc</span><br><span class="line"><span class="built_in">echo</span> “scale=3;23+33” | bc</span><br></pre></td></tr></table></figure><h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><h2 id="函数定义和使用"><a href="#函数定义和使用" class="headerlink" title="函数定义和使用"></a>函数定义和使用</h2><p>Linux Shell中的函数和大多数编程语言中的函数一样，将相似的任务或代码封装到函数中，供其他地方调用</p><p>语法一</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">name</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">  command1</span><br><span class="line">  command2</span><br><span class="line">  ....</span><br><span class="line">  commandn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>语法二</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> name</span><br><span class="line">&#123;</span><br><span class="line">  command1</span><br><span class="line">  command2</span><br><span class="line">  ....</span><br><span class="line">  commandn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="如何调用"><a href="#如何调用" class="headerlink" title="如何调用"></a>如何调用</h2><ol><li>直接使用函数名调用，可以将其想象成 Shell 中的一条命令</li><li>函数内部可以直接使用函数 $1,$2…$n</li><li>调用函数：function_name $1 $2</li></ol><h2 id="例题-1"><a href="#例题-1" class="headerlink" title="例题"></a>例题</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 判断进程是否存在，否则启动</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#脚本名含有nginx会返回0</span></span><br><span class="line"><span class="comment"># echo $$ 运行脚本产生的进程id</span></span><br><span class="line">this_pid=$$</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">ps -eff | grep nginx | grep -v grep | grep -v <span class="variable">$this_pid</span> &amp;&gt; /dev/null</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Nignx is running well&quot;</span></span><br><span class="line">    sleepp 3</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">    systemctl start nginx</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Nginx is down,start it..&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>判断进程</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netstat -tnlp | grep :80</span><br><span class="line">curl localhost/index.html</span><br></pre></td></tr></table></figure><h1 id="向函数传递参数"><a href="#向函数传递参数" class="headerlink" title="向函数传递参数"></a>向函数传递参数</h1><h2 id="shell传参"><a href="#shell传参" class="headerlink" title="shell传参"></a>shell传参</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> name</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Hello <span class="variable">$1</span>&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Hello <span class="variable">$2</span>&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="函数返回值"><a href="#函数返回值" class="headerlink" title="函数返回值"></a>函数返回值</h2><ol><li>return</li><li>echo</li></ol><h3 id="reutrn-返回值"><a href="#reutrn-返回值" class="headerlink" title="reutrn 返回值"></a>reutrn 返回值</h3><ol><li>只能返回1-255的整数</li><li>通常智能用来供其他地方调用获取状态，因此仅返回0（成功)，1(失败)</li></ol><h3 id="echo-返回值"><a href="#echo-返回值" class="headerlink" title="echo 返回值"></a>echo 返回值</h3><ol><li>可以返回任何字符串结果</li><li>通常用于返回数据，如一个字符串值或列表值</li></ol><h1 id="局部变量全局变量"><a href="#局部变量全局变量" class="headerlink" title="局部变量全局变量"></a>局部变量全局变量</h1><h2 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h2><ol><li>不做特殊处理，shell 中变量为全局变量</li><li>大型脚本程序慎用</li></ol><h2 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h2><ol><li>定义时，使用local关键字</li><li>函数内外如果存在同名变量，册函数内部变量覆盖外部变量</li></ol><h2 id="函数库"><a href="#函数库" class="headerlink" title="函数库"></a>函数库</h2><ul><li>为什么要定义函数库</li></ul><ol><li>经常使用的重复代码封装成函数文件</li><li>一般不直接执行，而是由其他脚本调用</li></ol><p>实例</p><figure class="highlight sh"><figcaption><span>库文件</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> add</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;`expr <span class="variable">$1</span> + <span class="variable">$2</span>`&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> reduce</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;`expr <span class="variable">$1</span> - <span class="variable">$2</span>`&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> multiple</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;`expr <span class="variable">$1</span> \* <span class="variable">$2</span>`&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> diveid</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;`expr <span class="variable">$1</span> / <span class="variable">$2</span>`&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> sys_load</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Memory Info&quot;</span></span><br><span class="line">    free -m</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Disk Usage&quot;</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="built_in">df</span> -h </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">. /home/vitan/workplace/Shell/learn/function/base_function</span><br><span class="line">add 122 3</span><br><span class="line">reduce 9 3</span><br><span class="line">multiple 22 11</span><br><span class="line">diveid 12 3</span><br><span class="line">sys_load</span><br></pre></td></tr></table></figure><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol><li>库文件名的后缀是任意的，但一般用 <code>.lib</code></li><li>库文件通常没有可执行权限</li><li>库文件无需和脚本在同级目录，只需在脚本中引时指定</li><li>第一行一般使用 <code>#!/bin/bash/echo</code> ，输出警告信息，避免用户执行</li></ol><h1 id="文件查找之find命令"><a href="#文件查找之find命令" class="headerlink" title="文件查找之find命令"></a>文件查找之find命令</h1><p>find [路径][选项][操作]</p><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190720205155.png"></p><h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><ol><li>查找 &#x2F;etc 目录下 conf 结尾的文件<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fing /etc -name <span class="string">&#x27;.conf&#x27;</span></span><br></pre></td></tr></table></figure></li><li>查找当前目录下文件名为 aa 的文件，不区分大小写<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -name aa</span><br></pre></td></tr></table></figure></li><li>查找文件属主为 hdfs 的所有文件<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -user hdfs</span><br></pre></td></tr></table></figure></li><li>查找文件属组为 yarn 的所有文件<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -group yarm</span><br></pre></td></tr></table></figure></li></ol><hr><h2 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h2><ol><li>-type</li></ol><ul><li>f 文件 find . -type f</li><li>d 目录 dind . -type d</li><li>c 字符设备文件 dind . -type c</li><li>b 块设备文件 dind . -type b</li><li>l 链接文件 dind . -type l</li><li>p 管道文件 dind . -type p</li></ul><ol start="2"><li>-size</li></ol><ul><li>-n 大小小于n的文件</li><li>+n 大小大于n的文件</li><li>n 大小等于n的文件</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 小于10000字节的文件</span></span><br><span class="line">find /etc -size -10000c</span><br><span class="line"><span class="comment"># 大于1M的文件</span></span><br><span class="line">find /etc -size +1M</span><br></pre></td></tr></table></figure><ol start="3"><li>-mtime<ul><li>-n n天以内修改的文件</li><li>+n n天以外修改的文件</li><li>n 正好n天修改的文件</li></ul></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查找/etc下5天内修改的conf结尾的文件</span></span><br><span class="line">find /etc -mtime -5 -name <span class="string">&#x27;*.conf&#x27;</span>       </span><br><span class="line"><span class="comment"># 查找10天之前修改且属主为root的文件</span></span><br><span class="line">find /etc -mtime +10 -user root</span><br></pre></td></tr></table></figure><ol start="4"><li>-mmin<ul><li>-n n分种内修改的文件</li><li>+n n分钟外修改的文件</li></ul></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 30分钟前修改的文件</span></span><br><span class="line">find /etc -mmin +30</span><br><span class="line"><span class="comment"># 30分钟内修改的目录</span></span><br><span class="line">find /etc -mmin -3o -<span class="built_in">type</span> d</span><br></pre></td></tr></table></figure><ol start="5"><li>-mindepth n<ul><li>表示从n级子目录开始搜索</li></ul></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc -mindepth 3</span><br></pre></td></tr></table></figure><ol start="6"><li>-maxdepth n<ul><li>表示最多搜索n-1级子目录</li></ul></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find /etc -maxdepth 3 -name <span class="string">&#x27;*.conf&#x27;</span></span><br><span class="line">find ./etc -<span class="built_in">type</span> f -name <span class="string">&#x27;.*conf&#x27;</span> -size +10k -maxdepth 2</span><br><span class="line">find . -<span class="built_in">type</span> f -nogroup</span><br></pre></td></tr></table></figure><ol start="7"><li><p>-perm</p><ul><li>find .perm 644</li></ul></li><li><p>-prune</p><ul><li>通常和-path一起用，用于将特定目录排除在搜索条件之外</li></ul></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找当前目录下所有普通文件，排除test目录</span></span><br><span class="line">find . -path ./etc -prune -o -<span class="built_in">type</span> f</span><br><span class="line"><span class="comment"># 查找当前目录下所有普通文件，但排除etc和opt目录</span></span><br><span class="line">find . -path ./etc -prune -o -path ./opt -prune -o -<span class="built_in">type</span> f</span><br><span class="line"><span class="comment"># 当前目录所有普通文件，排除etc和opt目录，但属主为hdfs</span></span><br><span class="line">find . -path ./etc -prune -o -path ./opt -prune -o -<span class="built_in">type</span> -f -a -user hdfs</span><br><span class="line"><span class="comment"># 当前目录所有普通文件，排除etc和opt目录，但属主为hdfs,文件大小大于</span></span><br><span class="line">find . -path ./etc -prune -o -path ./opt -prune -o -<span class="built_in">type</span> -f -a -user hdfs -a -size +2M</span><br></pre></td></tr></table></figure><ol start="9"><li>-newer file1<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc -newer a</span><br></pre></td></tr></table></figure></li></ol><ul><li><p>操作</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 搜索/etc下的文件非目录，以conf结尾，大于19k，然后删除</span></span><br><span class="line">find ./etc -<span class="built_in">type</span> -f -name <span class="string">&#x27;*.conf&#x27;</span> -size +10k -<span class="built_in">exec</span> <span class="built_in">rm</span> -rf &#123;&#125; \;</span><br><span class="line"></span><br><span class="line">find /var/log/ -name <span class="string">&#x27;*.log&#x27;</span> -mtime +7 -<span class="built_in">exec</span> <span class="built_in">rm</span> -rf &#123;&#125; \;</span><br><span class="line">find /etc -size +10k -<span class="built_in">type</span> -f -name <span class="string">&#x27;*.conf&#x27;</span> -<span class="built_in">exec</span> <span class="built_in">cp</span> &#123;&#125; /root/conf/ \;</span><br></pre></td></tr></table></figure><ul><li>-print 打印输出</li><li>-exec 对搜索的文件执行特定的操作</li><li>-ok 和exec功能一样，但每次操作都会给用户提示</li></ul></li><li><p>逻辑运算符</p><ul><li>-a 与</li><li>-o 或</li><li>-not|! 非</li></ul></li></ul><h1 id="find-locate-whereis和-which-总结及使用场景分析"><a href="#find-locate-whereis和-which-总结及使用场景分析" class="headerlink" title="find locate whereis和 which 总结及使用场景分析"></a>find locate whereis和 which 总结及使用场景分析</h1><h2 id="locate"><a href="#locate" class="headerlink" title="locate"></a>locate</h2><ol><li>文件查找命令，所属软件包mlocate</li><li>不同于find命令是在整块磁盘中搜索，locate在数据库文件中查找</li><li>find默认全部匹配，locate默认部分匹配</li></ol><ul><li>updatedb命令<ol><li>用于更新&#x2F;var&#x2F;lib&#x2F;mlocate&#x2F;mlocate.db</li><li>所使用配置文件&#x2F;etc&#x2F;update.conf</li><li>该命令在后台cron计划任务定期执行</li></ol></li></ul><h2 id="whereis选项和含义"><a href="#whereis选项和含义" class="headerlink" title="whereis选项和含义"></a>whereis选项和含义</h2><ul><li>-b 只返回二进制文件</li><li>-m 只返回帮助文档文件</li><li>-s 只返回源码文件</li></ul><h2 id="which"><a href="#which" class="headerlink" title="which"></a>which</h2><ul><li>仅查找二进制程序文件</li><li>选项<ul><li>-b 只返回二进制文件</li></ul></li></ul><h2 id="各命令使用场景推荐"><a href="#各命令使用场景推荐" class="headerlink" title="各命令使用场景推荐"></a>各命令使用场景推荐</h2><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721094218.png"></p><h1 id="grep和egrep"><a href="#grep和egrep" class="headerlink" title="grep和egrep"></a>grep和egrep</h1><h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><p>语法</p><ol><li>grep [option] [pattern] [file1,file2…]</li><li>command | grep [option] [pattern]</li></ol><p>grep参数</p><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721094721.png"><br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721094812.png"></p><ul><li>grep -E “python | PYTHON” file</li></ul><h2 id="egrep"><a href="#egrep" class="headerlink" title="egrep"></a>egrep</h2><p>egrep语法</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">egrep(选项)(查找模式)(文件名1，文件名2，……)</span><br></pre></td></tr></table></figure><h1 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h1><p>sed(Stream Editor)，流编辑器，对标准输出或文件逐行进行处理</p><h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><ol><li>stdot | sed [option] “pattern command”</li><li>sed [option] “pattern command” file</li></ol><h2 id="选项-1"><a href="#选项-1" class="headerlink" title="选项"></a>选项</h2><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721095810.png"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sed ‘p’ sed.tet <span class="comment"># p打印出来</span></span><br><span class="line">sed -n‘p’ sed.tet</span><br><span class="line"><span class="comment"># 不加参数，原行也会再打印一次</span></span><br><span class="line">sed ‘/python/p’sed.txt  <span class="comment">#查找行</span></span><br><span class="line">sed -n‘/python/p’sed.txt  <span class="comment">#查找行</span></span><br><span class="line"><span class="comment"># 多个匹配条件</span></span><br><span class="line">sed -n -e ‘/python/p’ -e ‘/PYTHON/p’ sed.txt</span><br><span class="line"><span class="comment">#文件中的</span></span><br><span class="line">Vim edit.sed</span><br><span class="line">/python/p</span><br><span class="line">Sed -n -f edit.sed sed.txt</span><br><span class="line">Sed -n -r‘/python|PYTHON/p’ sed.txt <span class="comment">#使用扩展正则表达式</span></span><br><span class="line"><span class="comment"># 修改</span></span><br><span class="line">sed -n ‘s/love/like/g’ sed.txt <span class="comment"># love替换为like</span></span><br><span class="line">sed -i‘s/love/like/g’ sed.txt <span class="comment">#修改源文件</span></span><br></pre></td></tr></table></figure><h2 id="sed-的-pattern-详解"><a href="#sed-的-pattern-详解" class="headerlink" title="sed 的 pattern 详解"></a>sed 的 pattern 详解</h2><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721100028.png"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打印file的17行</span></span><br><span class="line">sed -n <span class="string">&quot;17p&quot;</span> file</span><br><span class="line"><span class="comment"># 打印10到20行</span></span><br><span class="line">sed -n <span class="string">&quot;10,20p&quot;</span> file</span><br><span class="line"><span class="comment"># 打印第10行开始，往后加5行的内容</span></span><br><span class="line">sed -n <span class="string">&quot;10,+5p&quot;</span> file</span><br><span class="line"><span class="comment"># 以root开头的行</span></span><br><span class="line">sed -n <span class="string">&quot;/^root/p&quot;</span> file</span><br><span class="line"><span class="comment"># 打印第一个匹配到ftp开头的行</span></span><br><span class="line">sed -n <span class="string">&quot;/^root/,/^ftp/p&quot;</span> file</span><br><span class="line"><span class="comment"># 打印第四行开始，到以hdgs开头的</span></span><br><span class="line">sed -n <span class="string">&quot;4,/^hdfs/p&quot;</span> file</span><br><span class="line"><span class="comment"># 匹配root的行，直到第10行结束</span></span><br><span class="line">sed -n <span class="string">&quot;/root/,10p&quot;</span> file</span><br></pre></td></tr></table></figure><h2 id="sed-中的编辑命令"><a href="#sed-中的编辑命令" class="headerlink" title="sed 中的编辑命令"></a>sed 中的编辑命令</h2><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721100852.png"><br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721100931.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">sed -i‘1d/ sed.txt # 删除第一行</span><br><span class="line">sed -i ‘1,3d’sed.txt # 删除1-3行</span><br><span class="line">sed -i ‘/\/sbin\/nologin/d’passwd # 把不可登录的账号删除</span><br><span class="line">sed -i ‘/^mail,/^ftp/d’pssswd #mail到ftp</span><br><span class="line">文本追加</span><br><span class="line">sed -i ‘/\/bin\/bash/a This is user which can login to system’pssswd # 行后追加</span><br><span class="line">sed -i ‘/^hdfs/,/&amp;yarn/i AAAAAA’ pssswd # 行间追加</span><br><span class="line">sed -i ‘/root/r list’ passwd #把list内容追加root行后面</span><br><span class="line">sed -n‘/\/bin\/bash/w /tmp/user_login.txt’passwd #保存</span><br><span class="line"></span><br><span class="line">sed -i ‘s/\/bin\/bash/\/BIN\/BASH/g’passwd # 小写的替换为大写</span><br><span class="line">sed -i ‘a/root/ROOT/’passwd # 替换第一个root为大写</span><br><span class="line">sed -i ‘a/root/ROOT/2’passwd # 替换前两个个root为大写</span><br><span class="line">sed -i ‘s/hadoop/HADOOP/ig’str.txt #不区分大小写</span><br><span class="line">sed -n ‘/\/sbin\/nologin/=’passwd # 查看行号,不显示内容</span><br><span class="line"></span><br><span class="line">sed -i ‘s/had..p/hadoops/g’ sed.txt #.任意一个字符</span><br><span class="line">sed -i ‘s/had..p/&amp;s/g’ sed.txt #hadXXp后面加s，反向引用</span><br><span class="line">sed -i ‘s\/(had..ps\)\/1O/g’ sed.txt #后加O</span><br><span class="line">sed -i ‘s/\(had\)...../\1doop/g’sed.txt # had后面替换</span><br></pre></td></tr></table></figure><h2 id="反向引用"><a href="#反向引用" class="headerlink" title="反向引用"></a>反向引用</h2><ul><li>是什么</li></ul><ol><li>&amp;和\1 引用模式匹配到的整个串</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file中寻找1开头的后跟两任意字符以e结尾的字符</span></span><br><span class="line">sed <span class="string">&quot;s/1..e/&amp;r/g&quot;</span> file</span><br><span class="line">sed <span class="string">&quot;s/\(1...e\)/\1r/g&quot;</span> file <span class="comment"># 使用\1代表搜寻到的字符串</span></span><br></pre></td></tr></table></figure><ul><li>上面两种方法实现一样的功能，分别使用&amp;和\1代表搜寻到的整个字符串</li><li>区别在于&amp;只能表示匹配到的完整字符串，只能引用整个字符串，而\1可以使用()对匹配到的</li><li>要替换匹配的字符串的一部分，name必须使用\1，不能使用&amp;</li></ul><h2 id="sed-引用变量"><a href="#sed-引用变量" class="headerlink" title="sed 引用变量"></a>sed 引用变量</h2><ul><li>注意</li></ul><ol><li>匹配模式中存在变量，则建议使用双引号</li><li>sed中需要引入自定义变量时，如外面使用单引号，则自定义变量必须使用单引号</li></ol><h2 id="用-sed-查询特定内容"><a href="#用-sed-查询特定内容" class="headerlink" title="用 sed 查询特定内容"></a>用 sed 查询特定内容</h2><p>查询命令</p><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721102519.png"></p><p>实例</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打印/etc/passwd中的第20行内容</span></span><br><span class="line">sed -n <span class="string">&quot;20p&quot;</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">sed -n <span class="string">&quot;8,15p&quot;</span> /etc/passwd</span><br><span class="line">sed -n <span class="string">&quot;8,+5p&quot;</span> /etc/passwd</span><br><span class="line">sed -n <span class="string">&#x27;/^hdfs/p&#x27;</span> /etc/passwd</span><br><span class="line">sed -n <span class="string">&#x27;^root/,/^hdfs/p&#x27;</span> /etc/passwd</span><br><span class="line">sed -n <span class="string">&#x27;8,/\sbin\/nologin/p&#x27;</span> /etc/passwd</span><br><span class="line">sed -n <span class="string">&#x27;\bin\/bash/,5p&#x27;</span> /etc/passwd</span><br></pre></td></tr></table></figure><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721103230.png"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">FILE_NAME=/root/my.cnf</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> get_all_segments</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;`sed -n &#x27;/\[.*\]/p&#x27; <span class="variable">$FILE_NAME</span> | sed -e &#x27;s/\[//g&#x27; -e &#x27;s/\]//g&#x27;`&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> count_items_in_segment</span><br><span class="line">&#123;</span><br><span class="line">    items=`sed -n <span class="string">&#x27;/\[&#x27;</span><span class="variable">$1</span><span class="string">&#x27;\]/,/\[.*\]/p&#x27;</span> <span class="variable">$FILE_NAME</span> | grep -v <span class="string">&quot;^#&quot;</span> | grep -v ^$ | grep -v <span class="string">&quot;\[.*\]&quot;</span>`</span><br><span class="line">    index=0</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> <span class="variable">$items</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        index=`<span class="built_in">expr</span> <span class="variable">$index</span> +1`</span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$index</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">number=0</span><br><span class="line"><span class="keyword">for</span> segment <span class="keyword">in</span> `get_all_segments`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    num=`<span class="built_in">expr</span> <span class="variable">$number</span> + 1`</span><br><span class="line">    items_count=`coubt_items_in_segment <span class="variable">$segment</span>`</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$number</span>: <span class="variable">$segment</span> <span class="variable">$items_count</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="sed-删除特定内容"><a href="#sed-删除特定内容" class="headerlink" title="sed 删除特定内容"></a>sed 删除特定内容</h2><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721103352.png"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;15d&#x27;</span> passwd</span><br><span class="line">sed -i <span class="string">&#x27;8,14d&#x27;</span> passwd</span><br><span class="line">sed -i <span class="string">&#x27;/\sbin\/nologin/d&#x27;</span> passwd</span><br><span class="line">sed -i <span class="string">&#x27;/^mail/,/^yarn/d&#x27;</span> passwd</span><br><span class="line">sed -i <span class="string">&#x27;/\sbin\/nologin/,13d&#x27;</span> passwd</span><br><span class="line">sed -i <span class="string">&#x27;5,/^ftp/d&#x27;</span> passwd</span><br><span class="line"><span class="comment"># yarn开头到最后</span></span><br><span class="line">sed -i <span class="string">&#x27;/^yarn/,$&#x27;</span> /etc/passwd</span><br></pre></td></tr></table></figure><ul><li><ol><li>删除配置文件中所有的注释行和空行</li></ol></li><li><ol start="2"><li>在配置文件中所有不以#开头的行前面加×符合，主要以#开头的行不添加</li></ol></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -i ‘/^<span class="comment">#/d;/^$/d’ nginx.conf #删除注释</span></span><br><span class="line">sed -i ‘/[:blank:]*<span class="comment">#/d’ nginx.conf #删除空行</span></span><br><span class="line">sed -i ‘/^[^<span class="comment">#]/\*&amp;/g’nginx.conf  #非井号开头</span></span><br></pre></td></tr></table></figure><h2 id="sed-修改文件内容"><a href="#sed-修改文件内容" class="headerlink" title="sed 修改文件内容"></a>sed 修改文件内容</h2><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721104309.png"></p><p>实例</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改第一行的root为ROOT</span></span><br><span class="line">sed -i <span class="string">&#x27;1s/root/ROOT/&#x27;</span> passwd</span><br><span class="line"><span class="comment">#修改5到10行中所有的/sbin/nologin为/bin/bash</span></span><br><span class="line">sed -i <span class="string">&#x27;5,10s/\/sbin\/nologin/\bin\/bash/g&#x27;</span> passed</span><br><span class="line"><span class="comment">#修改匹配到/sbin/nologin的行，将匹配到行中的login改为LOGIN</span></span><br><span class="line">sed -i <span class="string">&#x27;/\sbin\/nologin/s/login/LOGIN/g&#x27;</span> passwd</span><br><span class="line"><span class="comment">#修改以root开头的行，到15行中的所有行，修改行中的nologin为SPARK</span></span><br><span class="line">sed -i <span class="string">&#x27;/^root/,15s/nologin/SPARK/g&#x27;</span> passwd</span><br><span class="line"><span class="comment">#从15行开始到匹配以yarn开头的所有行，修改行中的bin为BIN</span></span><br><span class="line">sed -i <span class="string">&#x27;15,/^yarn/s/bin/BIN/g&#x27;</span> passwd</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;s/[0-9]*//g&#x27;</span> file.txt</span><br></pre></td></tr></table></figure><h2 id="sed-追加文本内容"><a href="#sed-追加文本内容" class="headerlink" title="sed 追加文本内容"></a>sed 追加文本内容</h2><ul><li>语法</li></ul><ol><li>a<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第十行后追加&quot;Add lind behind&quot;</span></span><br><span class="line">sed -i <span class="string">&#x27;10a Add lind behind&#x27;</span> passwd</span><br><span class="line"><span class="comment"># 第10到20行，每一行后面都追加&quot;Test line behind&quot;</span></span><br><span class="line">sed -i <span class="string">&#x27;10,20a Test line behind&#x27;</span> passws</span><br><span class="line"><span class="comment"># 匹配到/bin/bash的行后面追加&quot;insert line for /bin/bash behind&quot;</span></span><br><span class="line">sed -i <span class="string">&#x27;/\bin\/bash/a insert line for /bin/bash behind&#x27;</span> passws</span><br></pre></td></tr></table></figure></li><li>i<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 匹配yarn开头的行，在匹配航后面追加&quot;Add lind behind&quot;</span></span><br><span class="line">sed -i <span class="string">&#x27;yarn/i Add lind behind&#x27;</span> passwd</span><br><span class="line"><span class="comment"># 每一行前面都追加“insert line before every line&quot;</span></span><br><span class="line">sed -i <span class="string">&#x27;i insert line before every line&#x27;</span> passwd</span><br></pre></td></tr></table></figure></li><li>r<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将/etc/fstab文件的内容追加到passwd的第20行后面</span></span><br><span class="line">sed -i <span class="string">&#x27;20r /etc/fstab&#x27;</span> passwd</span><br><span class="line"><span class="comment">#将/etc/inittab文件内容追加到passwd文件匹配/bin/bash行后面</span></span><br><span class="line">sed -i <span class="string">&#x27;/\bin\/bash/r /etc/inittab&#x27;</span> passwd</span><br><span class="line"><span class="comment">#将/etc/vconsol.conf文件内容追加到passwd文件中特定行的后面，匹配以ftp开头的行后面</span></span><br><span class="line">sed -i /^ftp/,18r /etc.vconsole.conf’ pssswd</span><br></pre></td></tr></table></figure></li><li>w<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将passwd文件匹配到/bin/bash的行追加到/tmp/sed.txt文件中</span></span><br><span class="line">sed -i <span class="string">&#x27;/\bin\/bash/w /tmp/sed.txt&#x27;</span> passwd</span><br><span class="line"><span class="comment"># 将passwd文件从10行还是到匹配到hsfs开头的所有行内容追加到/tmp/sed-1.txt</span></span><br><span class="line">sed -i <span class="string">&#x27;10,/^hsfs/w /tmp/sed-1.txt&#x27;</span> passwd</span><br></pre></td></tr></table></figure></li></ol><h1 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h1><h2 id="awk-的工作模式"><a href="#awk-的工作模式" class="headerlink" title="awk 的工作模式"></a>awk 的工作模式</h2><ol><li>awk 为一个文本处理工具，通常用于处理数据并产生结果报告。</li><li>命名是由三个创始人姓氏首字母组成</li></ol><h2 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;BEGIN&#123;&#125;pattern&#123;commands&#125;END&#123;&#125;&#x27;</span> file_name</span><br><span class="line"></span><br><span class="line">standard outpu | awk <span class="string">&#x27;BEGIN&#123;&#125;pattern&#123;commands&#125;END&#123;&#125;&#x27;</span> file_name</span><br></pre></td></tr></table></figure><ul><li>语法格式说明</li></ul><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721124926.png"></p><h2 id="awk-内置变量"><a href="#awk-内置变量" class="headerlink" title="awk 内置变量"></a>awk 内置变量</h2><p>内置变量对照表</p><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721125045.png"><br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721130039.png"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;&#123;print $0&#125;END&#123;&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line"><span class="comment"># 指定分隔符，输出第一个(既所有用户名)</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;&#123;print $1&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line"><span class="comment"># 默认空格为分割符</span></span><br><span class="line">awk <span class="string">&#x27;&#123;print $1&#x27;</span> list.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># NF每一个行字段个数（number Filed）</span></span><br><span class="line">awk <span class="string">&#x27;&#123;print NF&#125;&#x27;</span> list.txt <span class="comment"># 返回字段个数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># NR(Number Row)</span></span><br><span class="line">awk <span class="string">&#x27;&#123;print NR&#125;&#x27;</span> list.txt <span class="regexp">/etc/</span>passwd <span class="comment"># 返回行号</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># FNR(File Number Row)对每一个文件单独计数</span></span><br><span class="line">awk <span class="string">&#x27;&#123;print FNR&#125;&#x27;</span> list.txt <span class="regexp">/etc/</span>passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># FS(File Separator)</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;|&quot;&#125;&#123;print $2&#125;&#x27;</span> list.txt <span class="comment">#指定分割符|</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RS(Row Separator) 行分隔符</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;|&quot;;RS=&quot;--&quot;&#125;&#123;print $2&#125;&#x27;</span> list.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># ORS(Output Row Separatot) 输出行分割符</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;|&quot;;RS=&quot;--&quot;；ORS=&quot;&amp;&quot;&#125;&#123;print $2&#125;&#x27;</span> list.txt</span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;|&quot;;RS=&quot;--&quot;；ORS=&quot;&amp;&quot;;OFS=&quot;:&quot;&#125;&#123;print $2，$3&#125;&#x27;</span> list.txt</span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;&#123;print FILENAME&#125;&#x27;</span> list.txt <span class="comment">#对每一行输出文件名</span></span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;&#123;print ARGC&#125;&#x27;</span> list.txt <span class="comment"># 输出行参数个数</span></span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;&#123;print $NF&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd <span class="comment"># 输出行最大自的断</span></span><br></pre></td></tr></table></figure><h2 id="awk-格式化输出"><a href="#awk-格式化输出" class="headerlink" title="awk 格式化输出"></a>awk 格式化输出</h2><p>printf(默认不带分隔符) 语法</p><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721134349.png"></p><p>修饰符</p><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721134554.png"></p><p>实例</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不加任何修饰输出 </span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;&#123;printf $1&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line"><span class="comment"># 换行输出</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;&#123;printf &quot;%s\n&quot;,$1&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出两个变量</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;&#123;printf &quot;%s%s\n&quot;,$1,$7&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一个第二个变量长度20(默认右对齐)</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;&#123;printf &quot;%20s %20s\n&quot;,$1,$7&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一个第二个变量长度20(左对齐)</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;&#123;printf &quot;%-20s %-20s\n&quot;,$1,$7&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以字符串格式打印/etc/passwd中的第七个字段，以&quot;:&quot;为分隔符</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;&#123;printf &quot;%s\n&quot;,$7&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line"><span class="comment"># 以10进制格式打印/etc/passwd中的第3个字段，以&quot;:&quot;为分隔符</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125; &#123;printf &quot;%d\n&quot;,$3&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd <span class="comment">#不指定位数默认左对齐（指定位数右对齐 %-d)</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># 浮点数</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125; &#123;printf &quot;%o.3f\n&quot;,$3&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd </span><br><span class="line"></span><br><span class="line"><span class="comment"># 16进制</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125; &#123;printf &quot;%x\n&quot;,$3&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd </span><br><span class="line"></span><br><span class="line"><span class="comment"># 8进制</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125; &#123;printf &quot;%o\n&quot;,$3&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 科学计数法</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125; &#123;printf &quot;%e\n&quot;,$3&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br></pre></td></tr></table></figure><h2 id="awk模式匹配的两种用法"><a href="#awk模式匹配的两种用法" class="headerlink" title="awk模式匹配的两种用法"></a>awk模式匹配的两种用法</h2><ul><li>语法</li></ul><ol><li>RegExp 含义：按正则表达式匹配</li><li>关系运算 含义：按关系运算匹配</li></ol><p>实例</p><ul><li>RegExp</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 匹配/etc/passwd文件中含有root字符串的所有行</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;/root/&#123;print $0&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line"></span><br><span class="line"><span class="comment">#匹配/etc/passwd中yarn开头的所有行</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;/^yarn/&#123;print $0&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br></pre></td></tr></table></figure><ul><li><p>(运算符)关系运算</p><ul><li>关系运算符：&lt;,&gt;&lt;&#x3D;,&gt;&#x3D;,&#x3D;&#x3D;,!&#x3D;,~(匹配正则表达式),!~</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以：为分隔符，匹配第3个字段小于50的所有行信息</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;$3&lt;50&#123;print $0&#125;&#x27;</span> <span class="regexp">/etc/</span>pssswd</span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;$7==&quot;/bin/bash&quot;&#123;print $0&#125;&#x27;</span> <span class="regexp">/etc/</span>pssswd</span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;$7!=&quot;/bin/bash&quot;&#123;print $0&#125;&#x27;</span> <span class="regexp">/etc/</span>pssswd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第三个字符包含3个以上数字的所有行信息</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;$3~/[0-9]&#123;3,&#125;/&#123;print $0&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd <span class="comment"># &#123;3,&#125;重复3次</span></span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;$0~/\sbin\/nologin/&#123;print $0&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd </span><br></pre></td></tr></table></figure><ul><li>布尔运算:||(或),&amp;&amp;(与),!(非)</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以：为分隔符，匹配文件中包含hdfs或者yarn的所有行信息</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;$1==&quot;hdfs&quot; || $1==&quot;yarn&quot; &#123;print $0&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第三字段小于50且第四字段大于50的所有行信息</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;$3&lt;50 &amp;&amp; $4&gt;50 &#123;print $0&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;$3&lt;50 &amp;&amp; $7~/\bin\/bash/ &#123;print $0&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br></pre></td></tr></table></figure></li></ul><h2 id="awk-动作中的表达式用法"><a href="#awk-动作中的表达式用法" class="headerlink" title="awk 动作中的表达式用法"></a>awk 动作中的表达式用法</h2><p>算术运算符</p><table><thead><tr><th align="left">运算符</th><th align="left">含义</th></tr></thead><tbody><tr><td align="left">+</td><td align="left">加</td></tr><tr><td align="left">-</td><td align="left">减</td></tr><tr><td align="left">*</td><td align="left">乘</td></tr><tr><td align="left">&#x2F;</td><td align="left">除</td></tr><tr><td align="left">%</td><td align="left">模</td></tr><tr><td align="left">^或**</td><td align="left">乘方</td></tr><tr><td align="left">++X</td><td align="left">再返回X变量之前，X变量加1</td></tr><tr><td align="left">X++</td><td align="left">再返回X变量之后，X变量加1</td></tr></tbody></table><ul><li>实例</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;BEGIN&#123;var=20;var1=&quot;hello&quot;;print var,var1&#125;&#x27;</span></span><br><span class="line">  </span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;num1=20;num2+=num1;print num2,num2&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;num1=20;num2+=num1;print num2+num2&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;num1=20;num2=30;printf &quot;%0.2f\n&quot;,num1/num2&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;x=2;y=x++;print x,y&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;x=2;y=x--;print x,y&#125;&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 计算文件中空白行数量</span></span><br><span class="line">awk <span class="string">&#x27;/^$/&#123;sumx=0;sum++&#125;END&#123;print sum&#125;&#x27;</span> <span class="regexp">/etc/</span>services</span><br><span class="line">  </span><br><span class="line"><span class="comment"># 计算课程的平均分</span></span><br><span class="line">awk <span class="string">&#x27;&#123;total=S2+$3+$5+$5;AVG=total/4;printf &quot;%-8s,%-5d%-5d%-5d%-8d%0.2f\n&quot;,$1,$2,$3,$4.$5,AVG&#125;&#x27;</span> stu.txt</span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;printf &quot;%-8s%-8s%-8s%-8s%-8s%s\n&quot;,&quot;姓名&quot;,&quot;语文&quot;,&quot;数学&quot;,&quot;英语&quot;,&quot;物理&quot;,&quot;平均分&quot;&#125;&#123;total=$2+$3+$4+$5;AVG=total/4;printf &quot;%-8s%-8d%-8d%-8d%-8d%0.2f\n&quot;,$1,$2,$3,$4.$5,AVG&#125;&#x27;</span> stu.txt</span><br></pre></td></tr></table></figure><h2 id="awk-动作中的条件及循环语句"><a href="#awk-动作中的条件及循环语句" class="headerlink" title="awk 动作中的条件及循环语句"></a>awk 动作中的条件及循环语句</h2><ul><li>条件语句</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(条件表达式)</span><br><span class="line">  动作<span class="number">1</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(条件表达式)</span><br><span class="line">  动作<span class="number">2</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  动作<span class="number">3</span></span><br></pre></td></tr></table></figure><ul><li>实例</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以：为分隔符只打印第3个字段的数值在50-100范围内的行信息</span></span><br><span class="line">awk <span class="string">&#x27;BEFIN&#123;FS=&quot;:&quot;&#125;&#123;if($3&gt;50 &amp;&amp; $3&lt;100&gt;) print $0&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line">awk <span class="string">&#x27;BEFIN&#123;FS=&quot;:&quot;&#125;&#123;if($3&gt;50 || $3&lt;100&gt;) print $0&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 小于50的UID</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;&#123;if($3&lt;50) printf &quot;%-10s%-5d\n&quot;,&quot;小于50的UID:&quot;,$3&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line">  </span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;&#123;if($3&lt;50) printf &quot;%-10s%-10s%-5d\n&quot;,&quot;小于50的UID:&quot;,$1,$3&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;&#123;if($3&lt;50) printf &quot;%-10s%-10s%-5d\n&quot;,&quot;小于50的UID:&quot;,$1,$3&#125;&#x27;</span> <span class="regexp">/etc/</span>passwd</span><br></pre></td></tr></table></figure><ul><li>vim scripts.awk</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>&#123;</span><br><span class="line">    FS=<span class="string">&quot;:&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">    f(<span class="variable">$3</span>&lt;<span class="number">50</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    printf <span class="string">&quot;%-30s%-20s%-5d\n&quot;</span>,<span class="string">&quot;小于50的UID&quot;</span>,<span class="variable">$1</span>,<span class="variable">$3</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$3</span>&gt;<span class="number">50</span> &amp;&amp; <span class="variable">$3</span>&lt;<span class="number">100</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    printf <span class="string">&quot;%-30s%-20s%-5d\n&quot;</span>,<span class="string">&quot;大于50且小于100的UID&quot;</span>,<span class="variable">$1</span>,<span class="variable">$3</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    printf <span class="string">&quot;%-30s%-20s%-5d\n&quot;</span>,<span class="string">&quot;大于100的UID&quot;</span>,<span class="variable">$1</span>,<span class="variable">$3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>使用</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -f scripts.awk <span class="regexp">/etc/</span>passed</span><br></pre></td></tr></table></figure><ul><li>循环语句</li></ul><ol><li>do while 循环</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> <span class="keyword">while</span></span><br><span class="line">  <span class="keyword">do</span> </span><br><span class="line">      动作</span><br><span class="line">  <span class="keyword">while</span>(条件表达式)</span><br></pre></td></tr></table></figure><ol start="2"><li>for 循环</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (初始化计数器;测试计数器;计数器变更)</span><br><span class="line">  动作</span><br></pre></td></tr></table></figure><p>实例</p><ul><li>1+2+…100的和</li></ul><ol><li>while</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;=<span class="number">100</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      sum+=<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    print sum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>awk -f while.wak</p></li><li><p>for</p></li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(i0;i&lt;=<span class="number">100</span>;i++)</span><br><span class="line">  &#123;</span><br><span class="line">    sum+=<span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  print sum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>awk -f for.awk</li></ul><ol start="3"><li>do while</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>&#123;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    sum+=<span class="number">1</span></span><br><span class="line">    i++</span><br><span class="line">  &#125;<span class="keyword">while</span>(i&lt;=<span class="number">100</span>)</span><br><span class="line">  print sum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>awk -f do_while.awk</p></li><li><p>计算每个同学平均分，仅显示大于90</p></li></ul><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721185930.png"></p><figure class="highlight awk"><figcaption><span>student.awk</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>&#123;</span><br><span class="line">  printf <span class="string">&quot;%-10s%-10s%-10s%-10s%-10s%-10s\n&quot;</span>,<span class="string">&quot;Name&quot;</span>,<span class="string">&quot;Chinese&quot;</span>,<span class="string">&quot;English&quot;</span>,<span class="string">&quot;Math&quot;</span>,<span class="string">&quot;Physical&quot;</span>,<span class="string">&quot;Average&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  total=<span class="variable">$2</span>+<span class="variable">$3</span>+<span class="variable">$4</span>+<span class="variable">$5</span></span><br><span class="line">  avg=total/<span class="number">4</span></span><br><span class="line">  <span class="keyword">if</span>(avg&gt;<span class="number">90</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    printf <span class="string">&quot;%-10s%-10d%-10d%-10d%-10d%-0.2f\n&quot;</span>,<span class="variable">$1</span>,<span class="variable">$2</span>,<span class="variable">$3</span>,<span class="variable">$4</span>,<span class="variable">$5</span>,avg</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>计算平均分大于90的各科总分</li></ul><figure class="highlight awk"><figcaption><span>student.awk</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>&#123;</span><br><span class="line">    printf <span class="string">&quot;%-10s%-10s%-10s%-10s%-10s%-10s\n&quot;</span>,<span class="string">&quot;Name&quot;</span>,<span class="string">&quot;Chinese&quot;</span>,<span class="string">&quot;English&quot;</span>,<span class="string">&quot;Math&quot;</span>,<span class="string">&quot;Physical&quot;</span>,<span class="string">&quot;Average&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  total=<span class="variable">$2</span>+<span class="variable">$3</span>+<span class="variable">$4</span>+<span class="variable">$5</span></span><br><span class="line">  avg=total/<span class="number">4</span></span><br><span class="line">  <span class="keyword">if</span>(avg&gt;<span class="number">90</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    printf <span class="string">&quot;%-10s%-10d%-10d%-10d%-10d%-0.2f\n&quot;</span>,<span class="variable">$1</span>,<span class="variable">$2</span>,<span class="variable">$3</span>,<span class="variable">$4</span>,<span class="variable">$5</span>,avg</span><br><span class="line">    score_chinese+=<span class="variable">$2</span></span><br><span class="line">    score_english+=<span class="variable">$3</span></span><br><span class="line">    score_math+=<span class="variable">$4</span></span><br><span class="line">    score_physical+=<span class="variable">$5</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">END</span>&#123;</span><br><span class="line">  printf <span class="string">&quot;%-10s%-10d%-10d%-10d%-10d\n&quot;</span>,<span class="string">&quot;&quot;</span>,score_chinese,score_english,score_math,score_physical</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="awk-中的字符串函数"><a href="#awk-中的字符串函数" class="headerlink" title="awk 中的字符串函数"></a>awk 中的字符串函数</h2><p>字符串函数对照表</p><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721191406.png"><br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/ivitan/Picture@master/images/20190721191743.png"></p><p>例子</p><ol><li>以:为分隔符，返回文件中每行中的字段长度</li></ol><figure class="highlight awk"><figcaption><span>1.awk</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NF 字段个数</span></span><br><span class="line"><span class="keyword">BEGIN</span>&#123;</span><br><span class="line">  FS=<span class="string">&quot;:&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  i=<span class="number">1</span></span><br><span class="line">  <span class="keyword">while</span>(i&lt;=NF)</span><br><span class="line">  &#123; </span><br><span class="line">    <span class="keyword">if</span>(i==NF)</span><br><span class="line">      printf <span class="string">&quot;%d&quot;</span>,length(<span class="variable">$i</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      printf <span class="string">&quot;%d:&quot;</span>,length(<span class="variable">$i</span>)</span><br><span class="line">    i++</span><br><span class="line">  &#125;</span><br><span class="line">  print <span class="string">&quot;&quot;</span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><ol start="2"><li>搜索字符串”I have a dream”中出现”ea”子串的位置</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方法1</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;str=&quot;I have a dream&quot;;location=index(str,&quot;ea&quot;);print location&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#方法2</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;str=&quot;I have a dream&quot;;location=match(str,&quot;ea&quot;);print location&#125;&#x27;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>将字符串”Hadoop is a bigdata Framework”全部转为小写</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;BEGIN&#123;str=&quot;Hadoop is a bigdata Framework&quot;;print tolower(str)&#125;&#x27;</span></span><br></pre></td></tr></table></figure><ol start="4"><li>上一题转为大写</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;BEGIN&#123;str=&quot;Hadoop is a bigdata Framework&quot;;print toupper(str)&#125;&#x27;</span></span><br></pre></td></tr></table></figure><ol start="5"><li>将字符串”Hadoop Kafka Spark Storm”按空格为分隔符，分割每一部分保存到数组arr中</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;BEGIN&#123;str=&quot;Hadoop Kafka Spark Storm&quot;;split(str,arr,&quot; &quot;);print arr[0]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历(awk 下标从1开始)</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;str=&quot;Hadoop Kafka Spark Storm&quot;;split(str,arr,&quot; &quot;);for(a in arr) print arr[a]&#125;&#x27;</span></span><br></pre></td></tr></table></figure><ol start="6"><li>搜索字符串”Tranction 2345 start:select * from master”第一个数字出现的位置</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;BEGIN&#123;str=&quot;Tranction 2345 start:select * from master&quot;;location=match(str,/[0-9]/);print location&#125;&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>正则表达式要用 <code>//</code> 引起来</li></ul><ol start="7"><li>截图字符串”transaction start”的子串，条件从第4个字符开始，截取5为</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;BEGIN&#123;str=&quot;transaction start&quot;;print substr(str,4,5)&#125;&#x27;</span></span><br></pre></td></tr></table></figure><ol start="8"><li>替换”Tranction 243 start，Event ID：9002”中第一个匹配到的数字为$符号</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;BEGIN&#123;str=&quot;Tranction 243 start，Event ID：9002&quot;;count=sub(/[0-9]+/,&quot;$&quot;,str);print count,str&#125;&#x27;</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># gsu所有</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;str=&quot;Tranction 243 start，Event ID：9002&quot;;count=gsub(/[0-9]+/,&quot;$&quot;,str);print count,str&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="awk中的常用选项"><a href="#awk中的常用选项" class="headerlink" title="awk中的常用选项"></a>awk中的常用选项</h2><table><thead><tr><th align="left">选项</th><th align="left">解释</th></tr></thead><tbody><tr><td align="left">-v</td><td align="left">参数传递</td></tr><tr><td align="left">-f</td><td align="left">指定脚本文件</td></tr><tr><td align="left">-F</td><td align="left">指定分隔符</td></tr><tr><td align="left">-V</td><td align="left">查看awk的版本号</td></tr></tbody></table><p>实例</p><ul><li>-v 把外部变量引入</li></ul><figure class="highlight sh"><figcaption><span>终端中</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">num1=20</span><br><span class="line">var=<span class="string">&quot;Hello World&quot;</span></span><br><span class="line">awk -v num2=<span class="string">&quot;<span class="variable">$num1</span>&quot;</span> -v var1=<span class="string">&quot;<span class="variable">$var</span>&quot;</span> <span class="string">&#x27;BEGIN&#123;print num2,var1&#125;&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>-f 引入文件</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -f student.awk /etc/passws</span><br></pre></td></tr></table></figure><ul><li>-F</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">awk -F <span class="string">&quot;:&quot;</span> <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F : <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> /etc/passwd</span><br><span class="line"><span class="comment"># 等价于</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;&#123;print $7&#125;&#x27;</span> /etc/passwd</span><br></pre></td></tr></table></figure><h2 id="Shell-数组的用法"><a href="#Shell-数组的用法" class="headerlink" title="Shell 数组的用法"></a>Shell 数组的用法</h2><ul><li>array&#x3D;(“Mike”,”Bell”,”Hellen”)<ul><li>下面的 <code>井</code> 为 <code>#</code></li></ul></li></ul><table><thead><tr><th align="left">解释</th><th align="left">代码</th></tr></thead><tbody><tr><td align="left">打印元素</td><td align="left">echo ${井array[2]}</td></tr><tr><td align="left">打印元素个数</td><td align="left">echo ${井array[@]} &#x2F; echo ${井array[*]}</td></tr><tr><td align="left">打印元素长度</td><td align="left">echo ${井array[3]}</td></tr><tr><td align="left">给元素赋值</td><td align="left">array[3]&#x3D;”LI”</td></tr><tr><td align="left">删除元素</td><td align="left">unset array[2];unset array</td></tr><tr><td align="left">分片访问</td><td align="left">echo ${井array[@]:1:3}</td></tr><tr><td align="left">元素内容替换</td><td align="left">${array[@]&#x2F;e&#x2F;E} #只替换第一个e;${array[@]&#x2F;&#x2F;e&#x2F;E}替换全部e</td></tr></tbody></table><ul><li>数组遍历</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> array</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">   <span class="built_in">echo</span> <span class="variable">$a</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="awk-数组用法"><a href="#awk-数组用法" class="headerlink" title="awk 数组用法"></a>awk 数组用法</h2><ul><li>awk中使用数组时，不仅可以使用数字作为数组下标，也可以使用字符串作为数组下标</li></ul><ol><li>统计主机上所有TCP连接状态，按照每个TCP状态分类</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -an | grep tcp | awk <span class="string">&#x27;&#123;arrary[$6]++&#125;END&#123;for(a in arrary) print a,arrary[a]&#125;&#x27;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>计算横向数总和，计算纵向数据总和</li></ol><figure class="highlight sh"><figcaption><span>数据</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Allen 80 90 96 98</span><br><span class="line">Mike  93 98 92 91</span><br><span class="line">Zhang 78 76 87 92</span><br><span class="line">Jerry 86 89 68 92</span><br><span class="line">Han   85 95 75 90</span><br><span class="line">Li    78 88 98 100</span><br></pre></td></tr></table></figure><figure class="highlight sh"><figcaption><span>stu.awk</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">BEGIN&#123;</span><br><span class="line">  <span class="built_in">printf</span> <span class="string">&quot;%-10s%-10s%-10s%-10s%-10s%-10s\n&quot;</span>,<span class="string">&quot;Name&quot;</span>,<span class="string">&quot;Chinese&quot;</span>,<span class="string">&quot;Math&quot;</span>,<span class="string">&quot;English&quot;</span>,<span class="string">&quot;Physical&quot;</span>,<span class="string">&quot;Total&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  total=<span class="variable">$2</span>+<span class="variable">$3</span>+<span class="variable">$4</span>+<span class="variable">$5</span></span><br><span class="line">  yuwen_sum+=<span class="variable">$2</span></span><br><span class="line">  math_sum+=<span class="variable">$3</span></span><br><span class="line">  english_sum+=<span class="variable">$4</span></span><br><span class="line">  physical_sum+=<span class="variable">$5</span></span><br><span class="line">  <span class="built_in">printf</span> <span class="string">&quot;%-10s%-10d%-10d%-10d%-10d%-10d\n&quot;</span>,<span class="variable">$1</span>,<span class="variable">$2</span>,<span class="variable">$3</span>,<span class="variable">$4</span>,<span class="variable">$5</span>,total</span><br><span class="line">&#125;</span><br><span class="line">END&#123;</span><br><span class="line">  <span class="built_in">printf</span> <span class="string">&quot;%-10s%-10d%-10d%-10d%-10d\n&quot;</span>,<span class="string">&quot;&quot;</span>,yuwen_sum,math_sum,english_sum,physical_sum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="awk-处理数据例子"><a href="#awk-处理数据例子" class="headerlink" title="awk 处理数据例子"></a>awk 处理数据例子</h2><p>生成随机数据</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">create_random</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">  min=<span class="variable">$1</span></span><br><span class="line">  max=$((<span class="variable">$2</span>-<span class="variable">$min</span>+<span class="number">1</span>))</span><br><span class="line">  num=$(<span class="built_in">date</span> +%s%N)</span><br><span class="line">  <span class="built_in">echo</span> $((<span class="variable">$num</span>%<span class="variable">$max</span>+<span class="variable">$min</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">INDEX=1</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="keyword">for</span> user <span class="keyword">in</span> Allen Mike Jerry Tracy Hanmeimei Lilei</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    COUNT=<span class="variable">$RANDOM</span></span><br><span class="line">    NUM1=`create_random 1 <span class="variable">$COUNT</span>`</span><br><span class="line">    NUM2=`<span class="built_in">expr</span> <span class="variable">$COUNT</span> - <span class="variable">$NUM1</span>`</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;`date &#x27;+%y-%m-%d %H:%M:%S&#x27;` <span class="variable">$INDEX</span> Batches: user <span class="variable">$user</span> insert <span class="variable">$COUNT</span> records into databases:product table:datail,insert <span class="variable">$NUM1</span> records successfully,failed <span class="variable">$NUM2</span> records&quot;</span> &gt;&gt; ./db.log.`<span class="built_in">date</span> +%Y%m%d`</span><br><span class="line">    INDEX=`<span class="built_in">expr</span> <span class="variable">$INSEX</span> + 1`</span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><ol><li>统计每个用户分别插入多少record</li></ol><figure class="highlight sh"><figcaption><span>tesst.awk</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">BEGIN&#123;</span><br><span class="line">  <span class="built_in">printf</span> <span class="string">&quot;%-10s%-10s\n&quot;</span>,<span class="string">&quot;User&quot;</span>,<span class="string">&quot;Total Records&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  USER[<span class="variable">$6</span>]+=<span class="variable">$8</span></span><br><span class="line">&#125;</span><br><span class="line">END&#123;</span><br><span class="line">  <span class="keyword">for</span>(u <span class="keyword">in</span> USER)</span><br><span class="line">    <span class="built_in">printf</span> <span class="string">&quot;%-20s%-20d\n&quot;</span>,u,USER[u]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>统计每个用户分别插入成功和失败各多少record</li></ol><figure class="highlight sh"><figcaption><span>2.awk</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">BEGIN&#123;</span><br><span class="line">  <span class="built_in">printf</span> <span class="string">&quot;%-10s%-20s%-20s\n&quot;</span>,<span class="string">&quot;User,&quot;</span>Success_Records<span class="string">&quot;,&quot;</span>Filed_records<span class="string">&quot;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  SUCCESS[<span class="variable">$6</span>]+=<span class="variable">$14</span></span></span><br><span class="line"><span class="string">  FAILED[<span class="variable">$6</span>]+=<span class="variable">$17</span></span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">END&#123;</span></span><br><span class="line"><span class="string">  for(u in SUCCESS)</span></span><br><span class="line"><span class="string">    printf &quot;</span>%-10s%-20d%-20d\n<span class="string">&quot;,u,SUCCESS[u],FAILED[u]</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>将例子1,2结合，一起输出每个用户分别插入多少条数据，成功失败各多少条</li></ol><figure class="highlight sh"><figcaption><span>3.awk</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  BEGIN&#123;</span><br><span class="line">    <span class="built_in">printf</span> <span class="string">&quot;%-30s%-30s%-30s%-30s\n&quot;</span>,<span class="string">&quot;Name&quot;</span>,<span class="string">&quot;total records&quot;</span>,<span class="string">&quot;success records&quot;</span>,<span class="string">&quot;failed records&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">    TOTAL_RECORDS[<span class="variable">$6</span>]+=<span class="variable">$8</span></span><br><span class="line">    SUCCESS[<span class="variable">$6</span>]+=<span class="variable">$14</span></span><br><span class="line">    FAILED[<span class="variable">$6</span>]+=<span class="variable">$17</span></span><br><span class="line">&#125;</span><br><span class="line">END&#123;</span><br><span class="line">    <span class="keyword">for</span>(u <span class="keyword">in</span> TOTAL_RECORDS)</span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&quot;%-30s%-30d%-30d%-30d\n&quot;</span>,u,TOTAL_RECORDS[u],SUCCESS[u],FAILED[u]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>在例子3的基础上，加上结尾，统计全部插入记录数，成功记录数，失败记录数</li></ol><ul><li>方法一</li></ul><figure class="highlight sh"><figcaption><span>3.awk</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">BEGIN&#123;</span><br><span class="line">    <span class="built_in">printf</span> <span class="string">&quot;%-30s%-30s%-30s%-30s\n&quot;</span>,<span class="string">&quot;Name&quot;</span>,<span class="string">&quot;total records&quot;</span>,<span class="string">&quot;success records&quot;</span>,<span class="string">&quot;failed records&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">    TOTAL_RECORDS[<span class="variable">$6</span>]+=<span class="variable">$8</span></span><br><span class="line">    SUCCESS[<span class="variable">$6</span>]+=<span class="variable">$14</span></span><br><span class="line">    FAILED[<span class="variable">$6</span>]+=<span class="variable">$17</span></span><br><span class="line">&#125;</span><br><span class="line">END&#123;</span><br><span class="line">    <span class="keyword">for</span>(u <span class="keyword">in</span> TOTAL_RECORDS)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"># 在统计出的结果数组中进行累加</span></span><br><span class="line">        records_sum+=TOTAL_RECORDS[u]</span><br><span class="line">        success_sum+=SUCCESS[u]</span><br><span class="line">        failed_sum+=FAILED[u]</span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&quot;%-30s%-30d%-30d%-30d\n&quot;</span>,u,TOTAL_RECORDS[u],SUCCESS[u],FAILED[u]</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="built_in">printf</span> <span class="string">&quot;%-30s%-30d%-30d%-30d\n&quot;</span>,<span class="string">&quot;&quot;</span>,records_sum,success_sum,failed_sum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>方法二</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">BEGIN&#123;</span><br><span class="line">    <span class="built_in">printf</span> <span class="string">&quot;%-30s%-30s%-30s%-30s\n&quot;</span>,<span class="string">&quot;Name&quot;</span>,<span class="string">&quot;total records&quot;</span>,<span class="string">&quot;success records&quot;</span>,<span class="string">&quot;failed records&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    RECORDS[<span class="variable">$6</span>]+=<span class="variable">$8</span></span><br><span class="line">    SUCCESS[<span class="variable">$6</span>]+=<span class="variable">$14</span></span><br><span class="line">    FAILED[<span class="variable">$6</span>]+=<span class="variable">$17</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 在原始数据中进行汇总计算</span></span><br><span class="line">    records_sum+=<span class="variable">$8</span></span><br><span class="line">    success_sum+=<span class="variable">$14</span></span><br><span class="line">    failed_sum+=<span class="variable">$17</span>   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">END&#123;</span><br><span class="line">    <span class="keyword">for</span>(u <span class="keyword">in</span> RECORDS)</span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&quot;%-30s%-30d%-30d%-30d\n&quot;</span>,u,RECORDS[u],SUCCESS[u],FAILED[u]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span> <span class="string">&quot;%-30s%-30d%-30d%-30d\n&quot;</span>,<span class="string">&quot;total&quot;</span>,records_sum,success_sum,failed_sum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>查找丢失数据的现象，也就是成功+失败的记录数不等于一共插入的记录数，找出这些数据并显示行号和对应行的日志信息</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;&#123;if($8!=$14+$17) print NR,$0&#125;&#x27;</span> db.log.20190722</span><br></pre></td></tr></table></figure><div class="article-footer reveal fs14"><section id="license"><div class="header"><span>许可协议</span></div><div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议</p></div></section></div></article><div class="related-wrap reveal" id="read-next"><section class="header cap theme"><span>接下来阅读</span></section><section class="body fs14"><a id="next" href="/posts/N1Box.html">斐讯 N1 盒子降级刷机<span class="note">较早</span></a><div class="line"></div><a id="prev" href="/posts/Termux-Httpd.html">Termux 局域网共享文件<span class="note">较新</span></a></section></div><div class="related-wrap md reveal" id="comments"><div class="cmt-title cap theme">快来参与讨论吧</div><div class="cmt-body valine"><div id="valine_container" class="valine_thread"><svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg></div></div></div><footer class="page-footer reveal fs12"><hr><div class="text"><p>本站由 <a href="/">@anonymity</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar">Stellar</a> 主题创建。<br>本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p></div></footer><div class="float-panel mobile-only blur" style="display:none"><button type="button" class="sidebar-toggle mobile" onclick="sidebar.toggle()"><svg class="icon" style="width:1em;height:1em;vertical-align:middle;fill:currentColor;overflow:hidden" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15301"><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 2.3 26.8 24.6 47.5 51.6 47.6h416.5v4z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15302"></path><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 1.9 27.7 23.9 49.7 51.6 51.6h416.5z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15303"></path></svg></button></div></div></div><div class="scripts"><script defer type="text/javascript">stellar={loadCSS:(e,s,t,n)=>{var i,l=window.document,a=l.createElement("link");if(s)i=s;else{var r=(l.body||l.getElementsByTagName("head")[0]).childNodes;i=r[r.length-1]}var o=l.styleSheets;if(n)for(var d in n)n.hasOwnProperty(d)&&a.setAttribute(d,n[d]);a.rel="stylesheet",a.href=e,a.media="only x",function e(s){if(l.body)return s();setTimeout((function(){e(s)}))}((function(){i.parentNode.insertBefore(a,s?i:i.nextSibling)}));var p=function(e){for(var s=a.href,t=o.length;t--;)if(o[t].href===s)return e();setTimeout((function(){p(e)}))};function u(){a.addEventListener&&a.removeEventListener("load",u),a.media=t||"all"}return a.addEventListener&&a.addEventListener("load",u),a.onloadcssdefined=p,p(u),a},loadScript:(e,s)=>new Promise((t,n)=>{var i=document.createElement("script");if(i.src=e,s)for(let e of Object.keys(s))i[e]=s[e];else i.async=!0;i.onerror=n,i.onload=i.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(i.onload=i.onreadystatechange=null,t())},document.head.appendChild(i)}),jQuery:e=>{"undefined"==typeof jQuery?stellar.loadScript(stellar.plugins.jQuery).then(e):e()}},stellar.github="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.7.0",stellar.config={date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"}},stellar.plugins={jQuery:"https://fastly.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"},stellar.plugins.stellar=Object.assign({sites:"/js/plugins/sites.js",friends:"/js/plugins/friends.js",ghinfo:"/js/plugins/ghinfo.js",timeline:"/js/plugins/timeline.js"}),stellar.plugins.marked=Object.assign("https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js"),stellar.plugins.lazyload=Object.assign({enable:!0,js:"https://fastly.jsdelivr.net/npm/vanilla-lazyload@17.3.1/dist/lazyload.min.js",transition:"blur"}),stellar.plugins.swiper=Object.assign({enable:!0,css:"https://unpkg.com/swiper@6/swiper-bundle.min.css",js:"https://unpkg.com/swiper@6/swiper-bundle.min.js"}),stellar.plugins.preload=Object.assign({enable:!0,service:"flying_pages",instant_page:"https://fastly.jsdelivr.net/gh/volantis-x/cdn-volantis@4.1.2/js/instant_page.js",flying_pages:"https://fastly.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"}),stellar.plugins.fancybox=Object.assign({enable:!0,js:"https://fastly.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js",css:"https://fastly.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css",selector:".swiper-slide img"})</script><script defer src="/js/main.js" async></script><script>function getEmojiMaps(){function e(e,n,t){return e+"/"+e+"-"+n+"."+t}for(var n={},t=1;t<=54;t++)n["tieba-"+t]=e("tieba",t,"png");for(t=1;t<=101;t++)n["qq-"+t]=e("qq",t,"gif");for(t=1;t<=116;t++)n["aru-"+t]=e("aru",t,"gif");for(t=1;t<=125;t++)n["twemoji-"+t]=e("twemoji",t,"png");for(t=1;t<=4;t++)n["weibo-"+t]=e("weibo",t,"png");return n}function load_comment(){document.getElementById("valine_container")&&stellar.loadScript("https://fastly.jsdelivr.net/gh/XuxuGood/simple-blog-cdn@main/js/Valine.min.js",{defer:!0}).then((function(){var e=document.getElementById("valine_container").getAttribute("comment_id");e||(e=decodeURI(window.location.pathname)),(new Valine).init(Object.assign({js:"https://fastly.jsdelivr.net/gh/XuxuGood/simple-blog-cdn@main/js/Valine.min.js",appId:"D33WPBHpBw2CjwdWpFvpUhDm-MdYXbMMI",appKey:"MzQtKvSeVPU4nS4ljd3zlbMp",placeholder:null,requiredFields:["nick","mail"],enableQQ:!0,recordIP:!1,avatar:"robohash",pageSize:10,lang:"zh-cn",highlight:!0,mathJax:!1,tagMeta:["博主","小伙伴","访客"],metaPlaceholder:{nick:"昵称/QQ号(必填)",mail:"邮箱（必填，完全保密）",link:"网址(https://)"},master:["6783037F2DF30EAB99F9FC256157D875"],friends:["6783037F2DF30EAB99F9FC256157D875"]},{el:"#valine_container",path:e,placeholder:"",emojiCDN:"https://fastly.jsdelivr.net/gh/cdn-x/emoji/valine/",emojiMaps:getEmojiMaps()}))}))}window.addEventListener("DOMContentLoaded",e=>{console.log("DOM fully loaded and parsed"),load_comment()})</script></div></body></html>